{% extends "base.html" %}
{% block title %}고객 상세 · SOMS{% endblock %}

{% block content %}
<input type="hidden" id="pagePersonId" value="{{ people.Person_ID }}">
<div class="py-4">
    <div class="container-fluid">
        <div class="row g-4">

            <div class="col-md-3">
                <div class="card border-0 shadow-sm sticky-top" style="top: 1.5rem; z-index: 100;">
                    <div class="card-body text-center p-4">

                        <div class="mb-4">
                            <div class="avatar-circle bg-primary bg-opacity-10 text-primary mx-auto mb-3 d-flex align-items-center justify-content-center shadow-sm"
                                 style="width: 80px; height: 80px; border-radius: 24px;">
                                <i class="bi bi-building fa-2x"></i>
                            </div>
                            <h4 class="fw-bold mb-1 text-dark">{{ people.Company }}</h4>
                            <div class="text-muted small">
                                {{ people.Business_Type or '업종 미지정' }}
                                {% if people.Business_Detail %} <span class="mx-1">|</span> {{ people.Business_Detail
                                }}{% endif %}
                            </div>
                        </div>

                        <div class="d-flex justify-content-center gap-2 mb-4 flex-wrap">
                            {% if people.Client_Sensitivity|string == '0' %}
                            <span class="badge bg-danger bg-opacity-10 text-danger border border-danger-subtle rounded-pill px-3 py-2">민감</span>
                            {% elif people.Client_Sensitivity|string == '2' %}
                            <span class="badge bg-warning bg-opacity-10 text-dark border border-warning-subtle rounded-pill px-3 py-2">VIP</span>
                            {% else %}
                            <span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary-subtle rounded-pill px-3 py-2">표준</span>
                            {% endif %}

                            {% if people.Report_YN == '0' or people.Report_YN == 'Y' %}
                            <span class="badge bg-success bg-opacity-10 text-success border border-success-subtle rounded-pill px-3 py-2">
                                <i class="bi bi-file-earmark-check me-1"></i>레포트 발송
                            </span>
                            {% else %}
                            <span class="badge bg-light text-muted border rounded-pill px-3 py-2">레포트 미발송</span>
                            {% endif %}
                        </div>

                        <hr class="dashed my-4 opacity-50">

                        <div class="text-start px-2">
                            <div class="mb-3 d-flex align-items-start">
                                <div class="me-3 text-secondary pt-1"><i class="bi bi-geo-alt-fill fs-5"></i></div>
                                <div>
                                    <div class="small text-muted fw-bold text-uppercase"
                                         style="font-size: 0.75rem; letter-spacing: 0.5px;">Location
                                    </div>
                                    <div class="fw-bold text-dark fs-5">{{ people.IDC or '-' }}</div>
                                    <div class="small text-secondary font-monospace">{{ people.Rack_Location or 'Rack 정보
                                        없음' }}
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3 d-flex align-items-center">
                                <div class="me-3 text-secondary"><i class="bi bi-person-badge-fill fs-5"></i></div>
                                <div>
                                    <div class="small text-muted fw-bold text-uppercase"
                                         style="font-size: 0.75rem; letter-spacing: 0.5px;">담당 영업
                                    </div>
                                    <div class="fw-bold text-dark">{{ people.Sales_Manager or '미지정' }}</div>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 mt-4 pt-2">
                            <button class="btn btn-outline-primary fw-bold py-2" data-bs-toggle="modal"
                                    data-bs-target="#customerEditModal">
                                <i class="bi bi-pencil-square me-1"></i> 정보 수정
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-9">
                <ul class="nav nav-tabs mb-4 border-bottom-0" style="font-size: 1rem;">
                        <li class="nav-item">
                            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-overview">
                                고객 개요
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-contracts">
                                계약 정보
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-assets">
                                보안장비
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-servers">
                                서버
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-contacts">
                                담당자
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-work">
                                작업 이력
                            </button>
                        </li>
                    </ul>

                <div class="tab-content">
                    <div class="tab-pane fade show active" id="tab-overview">
                        <div class="row g-4">

                            <div class="col-12">
                                <div class="card shadow-sm border-0 rounded-3">
                                    <div class="card-body p-4">
                                        <div class="row g-4">
                                            <div class="col-md-6 border-end">
                                                <h6 class="fw-bold text-secondary small text-uppercase mb-3"><i
                                                        class="bi bi-link-45deg me-1"></i>서비스 URL</h6>
                                                {% if people.Service_URL__c %}
                                                <div class="d-flex flex-column gap-2">
                                                    {% for url in people.Service_URL__c.split('\n') %}
                                                    {% if url.strip() %}
                                                    <a href="{{ url.strip() }}" target="_blank"
                                                       class="d-flex align-items-center p-2 bg-light rounded text-decoration-none text-dark hover-bg-primary-subtle transition-all">
                                                        <div class="bg-white p-1 rounded border me-2"><i
                                                                class="bi bi-globe text-primary"></i></div>
                                                        <span class="fw-medium text-truncate">{{ url.strip() }}</span>
                                                        <i class="bi bi-box-arrow-up-right ms-auto text-muted small"></i>
                                                    </a>
                                                    {% endif %}
                                                    {% endfor %}
                                                </div>
                                                {% else %}
                                                <div class="text-muted small p-2">등록된 URL이 없습니다.</div>
                                                {% endif %}
                                            </div>
                                            <div class="col-md-6 ps-md-4">
                                                <h6 class="fw-bold text-secondary small text-uppercase mb-3"><i
                                                        class="bi bi-folder2-open me-1"></i>자료실 (고객 폴더)</h6>
                                                {% if people.Customer_Folder %}
                                                <div class="p-3 bg-warning bg-opacity-10 rounded border border-warning-subtle mb-2">
                                                    <div class="d-flex align-items-center mb-2">
                                                        <i class="bi bi-folder-fill text-warning fs-4 me-2"></i>
                                                        <a href="{{ people.Customer_Folder }}" target="_blank"
                                                           class="fw-bold text-dark text-decoration-none stretched-link">폴더
                                                            바로가기</a>
                                                    </div>
                                                    <div class="small text-muted text-break font-monospace bg-white p-2 rounded border border-light">
                                                        {{ people.Customer_Folder }}
                                                    </div>
                                                </div>
                                                {% else %}
                                                <div class="text-muted small p-2">연결된 폴더가 없습니다.</div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="card shadow-sm border-0 rounded-3">
                                    <div class="card-header bg-white py-3 border-bottom">
                                        <h5 class="card-title mb-0 fw-bold"><i class="bi bi-hdd-network text-primary me-2"></i>부가서비스 정보</h5>
                                    </div>
                                    <div class="card-body p-4">
                                        <div class="row g-4">
                                            <div class="col-lg-7">
                                                <h6 class="fw-bold text-secondary small text-uppercase mb-3">백업 (Backup)</h6>
                                                <div class="table-responsive">
                                                    <table class="table table-sm table-borderless align-middle mb-0">
                                                        <tbody>
                                                            <tr class="border-bottom border-light">
                                                                <th class="text-secondary ps-0 py-2" style="width: 15%;">사용 여부</th>
                                                                <td class="py-2" style="width: 35%;">
                                                                    {% if people.Backup_Service == 'y' %}
                                                                    <span class="badge bg-primary bg-opacity-10 text-primary fw-bold">사용중</span>
                                                                    {% else %}
                                                                    <span class="badge bg-secondary bg-opacity-10 text-secondary">미사용</span>
                                                                    {% endif %}
                                                                </td>
                                                                <th class="text-secondary py-2" style="width: 15%;">수행 업체</th>
                                                                <td class="py-2 text-dark fw-bold" style="width: 35%;">{{ people.Backup_Vendor or '-' }}</td>
                                                            </tr>

                                                            <tr class="border-bottom border-light">
                                                                <th class="text-secondary ps-0 py-2">백업 유형</th>
                                                                <td class="py-2 text-dark">
                                                                    {% if people.Backup_Type|string == '0' %} 원격 (전체)
                                                                    {% elif people.Backup_Type|string == '1' %} 원격 (DB)
                                                                    {% elif people.Backup_Type|string == '2' %} 원격 (File)
                                                                    {% elif people.Backup_Type|string == '3' %} 로컬 (전체)
                                                                    {% elif people.Backup_Type|string == '4' %} 로컬 (DB)
                                                                    {% elif people.Backup_Type|string == '5' %} 로컬 (File)
                                                                    {% elif people.Backup_Type|string == '6' %} 소산 백업
                                                                    {% elif people.Backup_Type|string == '7' %} 원격 + 소산
                                                                    {% elif people.Backup_Type|string == '8' %} 로컬 + 소산
                                                                    {% else %} {{ people.Backup_Type or '-' }}
                                                                    {% endif %}
                                                                </td>
                                                                <th class="text-secondary py-2">주기 / 용량</th>
                                                                <td class="py-2 text-dark">{{ people.Backup_Period or '-' }}</td>
                                                            </tr>

                                                            <tr>
                                                                <th class="text-secondary ps-0 py-2">백업 경로</th>
                                                                <td colspan="3" class="py-2">
                                                                    <div class="bg-light p-2 rounded text-muted small font-monospace text-break border border-light-subtle">
                                                                        {{ people.Backup_Path or '-' }}
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>

                                            <div class="col-lg-5 border-start-lg ps-lg-4">
                                                <h6 class="fw-bold text-secondary small text-uppercase mb-3">보안 솔루션</h6>
                                                <div class="d-flex flex-column gap-3">
                                                    <div class="d-flex align-items-center p-3 bg-light rounded border border-light">
                                                        <div class="bg-white p-2 rounded-circle shadow-sm me-3 text-success">
                                                            <i class="bi bi-virus fs-5"></i>
                                                        </div>
                                                        <div>
                                                            <div class="small text-muted fw-bold">보안 백신</div>
                                                            <div class="fw-bold text-dark">{{ people.Vaccine__c or '미설치' }}</div>
                                                        </div>
                                                    </div>
                                                    <div class="d-flex align-items-center p-3 bg-light rounded border border-light">
                                                        <div class="bg-white p-2 rounded-circle shadow-sm me-3 text-info">
                                                            <i class="bi bi-terminal fs-5"></i>
                                                        </div>
                                                        <div>
                                                            <div class="small text-muted fw-bold">쉘 모니터링</div>
                                                            <div class="fw-bold text-dark">{{ people.ShellMonitor__c or '미설치' }}</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="row g-4">
                                    <div class="col-md-6">
                                        <div class="card shadow-sm border-0 h-100">
                                            <div class="card-header bg-danger bg-opacity-10 py-3 border-0 d-flex justify-content-between align-items-center">
                                                <h6 class="card-title mb-0 fw-bold text-danger"><i
                                                        class="bi bi-exclamation-triangle-fill me-2"></i>고객 특이사항</h6>
                                                {% if people.chEtc and people.chEtc.strip() %}
                                                <button class="btn btn-sm btn-light text-danger fw-bold border-danger border-opacity-25"
                                                        data-bs-toggle="modal" data-bs-target="#noteModalEtc">
                                                    <i class="bi bi-arrows-angle-expand me-1"></i>전체보기
                                                </button>
                                                {% endif %}
                                            </div>
                                            <div class="card-body bg-light">
                                                <div class="text-dark small"
                                                     style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; white-space: pre-line; line-height: 1.6;">{{ people.chEtc.strip() if people.chEtc else '등록된 특이사항이 없습니다.' }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="card shadow-sm border-0 h-100">
                                            <div class="card-header bg-warning bg-opacity-10 py-3 border-0 d-flex justify-content-between align-items-center">
                                                <h6 class="card-title mb-0 fw-bold text-warning-emphasis"><i
                                                        class="bi bi-shield-exclamation me-2"></i>침해대응 이력</h6>
                                                {% if people.chHistory and people.chHistory.strip() %}
                                                <button class="btn btn-sm btn-light text-warning-emphasis fw-bold border-warning border-opacity-25"
                                                        data-bs-toggle="modal" data-bs-target="#noteModalHistory">
                                                    <i class="bi bi-arrows-angle-expand me-1"></i>전체보기
                                                </button>
                                                {% endif %}
                                            </div>
                                            <div class="card-body bg-light">
                                                <div class="text-dark small"
                                                     style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; white-space: pre-line; line-height: 1.6;">{{ people.chHistory.strip() if people.chHistory else '등록된 침해대응 이력이 없습니다.' }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                            <!-- Contract Tab-->
                            <div class="tab-pane fade" id="tab-contracts">
                                <div class="card shadow-sm border-0">
                                    <div class="card-header bg-white py-3 border-bottom-0 d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5 class="card-title mb-1 fw-bold text-primary">
                                                <i class="bi bi-file-earmark-text me-2"></i>계약 목록
                                            </h5>
                                            <div class="text-muted small">이 고객사의 서비스 계약 현황입니다.</div>
                                        </div>
                                        <button class="btn btn-primary" onclick="openContractModal()">
                                            <i class="bi bi-plus-lg me-1"></i> 계약 추가
                                        </button>
                                    </div>
                                    <div class="card-body pt-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle mb-0">
                                                <thead class="table-light">
                                                <tr>
                                                    <th style="width:10%;" class="text-center">상태</th>
                                                    <th style="width:15%;">서비스 유형</th>
                                                    <th style="width:20%;">서비스 번호</th>
                                                    <th style="width:15%;">개통일</th>
                                                    <th style="width:15%;">해지일</th>
                                                    <th style="width:15%;">계약 금액</th>
                                                    <th style="width:10%;" class="text-center">관리</th>
                                                </tr>
                                                </thead>
                                                <tbody id="contractListBody">
                                                <tr>
                                                    <td colspan="7" class="text-center py-5">
                                                        <div class="spinner-border text-primary"></div>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Assets Tab -->
                            <div class="tab-pane fade" id="tab-assets">
                                <div class="card shadow-sm border-0">
                                    <div class="card-header bg-white py-3 border-bottom-0 d-flex justify-content-between align-items-center">
                                        <h5 class="card-title mb-0 fw-bold text-primary">
                                            <i class="bi bi-shield-lock me-2"></i>보안장비 목록
                                        </h5>
                                        <button class="btn btn-primary shadow-sm fw-bold" onclick="openCustRegister()">
                                            <i class="bi bi-plus-lg me-1"></i> 장비 추가
                                        </button>
                                    </div>
                                    <div class="card-body pt-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle mb-0"
                                                   style="width: 100%; table-layout: fixed;">
                                                <colgroup>
                                                    <col style="width: 20%;">
                                                    <col style="width: 20%;">
                                                    <col style="width: 10%;">
                                                    <col style="width: 12%;">
                                                    <col style="width: 14%;">
                                                    <col style="width: 9%;">
                                                    <col style="width: 10%;">
                                                    <col style="width: 100px;">
                                                </colgroup>
                                                <thead class="table-light">
                                                <tr>
                                                    <th class="text-secondary fw-bold py-3 ps-3">사이트명</th>
                                                    <th class="text-secondary fw-bold py-3">장비 이름 (CI 이름)</th>
                                                    <th class="text-secondary fw-bold py-3 text-center">제품 계층 2</th>
                                                    <th class="text-secondary fw-bold py-3 text-center">제품 이름</th>
                                                    <th class="text-secondary fw-bold py-3 text-center">IP</th>
                                                    <th class="text-secondary fw-bold py-3 text-center">운영모드</th>
                                                    <th class="text-secondary fw-bold py-3 text-center">공급자</th>
                                                    <th class="text-secondary fw-bold py-3 text-center">관리</th>
                                                </tr>
                                                </thead>
                                                <tbody style="font-size: 0.88rem;">
                                                {% for c in ci_rows %}
                                                <tr class="clickable-row" onclick="openCustDetail(this)"
                                                    data-id="{{ c.Asset_ID }}"
                                                    data-person-id="{{ people.Person_ID }}"
                                                    data-company="{{ people.Company }}"
                                                    data-site="{{ c.Owner_name or '-' }}"
                                                    data-name="{{ c.Name }}"
                                                    data-type="{{ c.Type }}"
                                                    data-product="{{ c.Product_Name }}"
                                                    data-ip="{{ c.IP_Address }}"
                                                    data-op-mode="{{ c.Operation_Mode }}"
                                                    data-supplier="{{ c.Supplier }}"
                                                    data-status="{{ c.AssetLifecycleStatus }}">

                                                    <td class="ps-3 fw-bold text-secondary">{{ c.Owner_name or '-' }}
                                                    </td>
                                                    <td>
                                                        <div class="fw-bold text-dark text-truncate"
                                                             title="{{ c.Name }}">{{ c.Name
                                                            }}
                                                        </div>
                                                    </td>
                                                    <td class="text-center"><span class="text-dark small">{{ c.Type or '-' }}</span>
                                                    </td>
                                                    <td class="text-center">
                                                        <div class="text-dark small text-truncate">{{ c.Product_Name or
                                                            '-' }}
                                                        </div>
                                                    </td>
                                                    <td class="text-center font-monospace small">{{ c.IP_Address or '-'
                                                        }}
                                                    </td>
                                                    <td class="text-center">
                                <span class="badge bg-light text-dark border">
                                    {% if c.Operation_Mode|string == '1' %} 탐지
                                    {% elif c.Operation_Mode|string == '2' %} 차단
                                    {% else %} {{ c.Operation_Mode or '-' }}
                                    {% endif %}
                                </span>
                                                    </td>
                                                    <td class="text-center"><span
                                                            class="text-dark small">{{ c.Supplier or '-' }}</span></td>
                                                    <td class="text-center" onclick="event.stopPropagation()">
                                                        <div class="d-flex justify-content-center gap-1">
                                                            <button class="btn btn-sm btn-outline-secondary"
                                                                    onclick="openCustEdit(this.closest('tr'))">
                                                                <i class="bi bi-pencil-fill"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-danger"
                                                                    onclick="deleteCustAsset({{ c.Asset_ID }})">
                                                                <i class="bi bi-trash-fill"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {% else %}
                                                <tr>
                                                    <td colspan="8" class="text-center py-5 text-muted">등록된 보안장비가
                                                        없습니다.
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Servers Tab -->
                            <div class="tab-pane fade" id="tab-servers">
                                <div class="card shadow-sm border-0">
                                    <div class="card-header bg-white py-3 border-bottom-0 d-flex justify-content-between align-items-center">
                                        <h5 class="card-title mb-0 fw-bold">
                                            <i class="bi bi-hdd-stack text-primary me-2"></i>서버 목록
                                        </h5>
                                        <button class="btn btn-primary" onclick="openServerAddModal()">
                                            <i class="bi bi-plus-lg me-1"></i> 서버 추가
                                        </button>
                                    </div>
                                    <div class="card-body pt-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle mb-0"
                                                   style="min-width: 900px;">
                                                <thead class="table-light">
                                                <tr>
                                                    <th class="text-secondary fw-bold py-3 ps-4" style="width: 25%;">
                                                        서버명
                                                    </th>
                                                    <th class="text-secondary fw-bold py-3" style="width: 25%;">서버 IP
                                                    </th>
                                                    <th class="text-secondary fw-bold py-3" style="width: 15%;">등록자</th>
                                                    <th class="text-secondary fw-bold py-3" style="width: 20%;">등록일시
                                                    </th>
                                                    <th class="text-secondary fw-bold py-3 text-center"
                                                        style="width: 15%;">관리
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% for s in server_rows %}
                                                <tr>
                                                    <td class="ps-4 fw-bold text-dark">{{ s.chServerName }}</td>
                                                    <td>
                                                        {% if s.chServerInfo %}
                                                        <span class="bg-light border px-2 py-1 rounded text-dark small font-monospace">{{ s.chServerInfo }}</span>
                                                        {% else %}
                                                        <span class="text-muted small">-</span>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <div class="bg-secondary bg-opacity-10 text-secondary me-2 rounded-circle d-flex align-items-center justify-content-center"
                                                                 style="width: 24px; height: 24px;">
                                                                <i class="bi bi-person-fill"
                                                                   style="font-size: 12px;"></i>
                                                            </div>
                                                            <span class="small fw-bold">{{ s.Submitter or '-' }}</span>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <span class="small text-muted font-monospace">{{ s.Create_Date.strftime('%Y-%m-%d %H:%M:%S') if s.Create_Date else '-' }}</span>
                                                    </td>
                                                    <td class="text-center">
                                                        <div class="d-flex justify-content-center gap-2">
                                                            <button type="button"
                                                                    class="btn btn-outline-secondary btn-square shadow-sm"
                                                                    onclick="editServer({{ s.Server_ID }}, '{{ people.Person_ID }}')">
                                                                <i class="bi bi-pencil-fill"
                                                                   style="font-size: 0.8rem;"></i>
                                                            </button>

                                                            <button type="button"
                                                                    class="btn btn-outline-danger btn-square shadow-sm"
                                                                    onclick="deleteServer({{ s.Server_ID }}, '{{ people.Person_ID }}')">
                                                                <i class="bi bi-trash-fill"
                                                                   style="font-size: 0.8rem;"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {% else %}
                                                <tr>
                                                    <td colspan="5" class="text-center text-muted py-5">등록된 서버가 없습니다.
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Contacts Tab -->
                            <div class="tab-pane fade" id="tab-contacts">
                                <div class="card shadow-sm border-0">
                                    <div class="card-header bg-white py-3 border-bottom-0 d-flex justify-content-between align-items-center">
                                        <h5 class="card-title mb-0 fw-bold">
                                            <i class="bi bi-person-lines-fill text-primary me-2"></i>담당자 목록
                                        </h5>
                                        <button class="btn btn-primary" onclick="openContactAddModal()">
                                            <i class="bi bi-plus-lg me-1"></i> 담당자 추가
                                        </button>
                                    </div>
                                    <div class="card-body pt-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle mb-0"
                                                   style="width: 100%; table-layout: fixed;">
                                                <colgroup>
                                                    <col style="width: 5%;">
                                                    <col style="width: 8%;">
                                                    <col style="width: 11%;">
                                                    <col style="width: 12%;">
                                                    <col style="width: 20%;">
                                                    <col style="width: 8%;">
                                                    <col style="width: 7%;">
                                                    <col style="width: 8%;">
                                                    <col style="width: 9%;">
                                                    <col style="width: 90px;">
                                                </colgroup>
                                                <thead class="table-light">
                                                <tr>
                                                    <th class="py-3 ps-3 text-secondary fw-bold">정/부</th>
                                                    <th class="py-3 text-secondary fw-bold">이름</th>
                                                    <th class="py-3 text-secondary fw-bold text-center">일반전화</th>
                                                    <th class="py-3 text-secondary fw-bold text-center">휴대폰 번호</th>
                                                    <th class="py-3 text-secondary fw-bold text-center">이메일</th>
                                                    <th class="py-3 text-center text-secondary fw-bold">상태</th>
                                                    <th class="py-3 text-center text-secondary fw-bold">침탐수신</th>
                                                    <th class="py-3 text-center text-secondary fw-bold">보고서수신</th>
                                                    <th class="py-3 text-center text-secondary fw-bold">등록일</th>
                                                    <th class="py-3 text-center text-secondary fw-bold">관리</th>
                                                </tr>
                                                </thead>
                                                <tbody style="font-size: 0.9rem;">
                                                {% for c in contact_rows %}
                                                <tr>
                                                    <td class="ps-3">{{ c.Role_Type }}</td>
                                                    <td class="fw-bold text-truncate" title="{{ c.Name }}">{{ c.Name
                                                        }}
                                                    </td>
                                                    <td class="text-center small">{{ c.General_Phone or '-' }}</td>
                                                    <td class="text-center small">{{ c.Phone or '-' }}</td>
                                                    <td class="text-center">
                                                        <div class="text-truncate px-1">{{ c.Email or '-' }}</div>
                                                    </td>
                                                    <td class="text-center">
                                                        {% if c.Status == '활성화' %}
                                                        <span class="badge bg-success bg-opacity-10 text-success border border-success rounded-pill">활성</span>
                                                        {% else %}
                                                        <span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary rounded-pill">비활성</span>
                                                        {% endif %}
                                                    </td>
                                                    <td class="text-center">{{ c.SMS_Receive_YN }}</td>
                                                    <td class="text-center">{{ c.Report_Receive_YN }}</td>
                                                    <td class="text-center small text-muted">{{
                                                        c.Reg_Date.strftime('%Y-%m-%d')
                                                        if c.Reg_Date else '-' }}
                                                    </td>
                                                    <td class="text-center">
                                                        <div class="d-flex justify-content-center gap-1">
                                                            <button type="button"
                                                                    class="btn btn-outline-secondary btn-square shadow-sm"
                                                                    onclick="openContactEditModal({{ c.Contact_ID }}, '{{ people.Person_ID }}')">
                                                                <i class="bi bi-pencil-fill"
                                                                   style="font-size: 0.8rem;"></i>
                                                            </button>
                                                            <button type="button"
                                                                    class="btn btn-outline-danger btn-square shadow-sm"
                                                                    onclick="deleteContact({{ c.Contact_ID }}, '{{ people.Person_ID }}')">
                                                                <i class="bi bi-trash-fill"
                                                                   style="font-size: 0.8rem;"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {% else %}
                                                <tr>
                                                    <td colspan="10" class="text-center text-muted py-5">데이터 없음</td>
                                                </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Work Tab -->
                            <div class="tab-pane fade" id="tab-work">
                                <div class="card shadow-sm border-0">
                                    <div class="card-header bg-white py-3 border-bottom-0 d-flex justify-content-between align-items-center">
                                        <h5 class="card-title mb-0 fw-bold">
                                            <i class="bi bi-journal-text text-primary me-2"></i>작업 이력
                                        </h5>
                                        <button class="btn btn-primary" data-bs-toggle="modal"
                                                data-bs-target="#workCreateModal">
                                            <i class="bi bi-plus-lg me-1"></i> 작업 추가
                                        </button>
                                    </div>

                                    <div class="card-body pt-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover align-middle mb-0">
                                                <colgroup>
                                                    <col style="width: 15%">
                                                    <col style="width: 15%">
                                                    <col style="width: auto">
                                                    <col style="width: 15%">
                                                    <col style="width: 5%">
                                                    <col style="width: 100px">
                                                </colgroup>
                                                <thead class="table-light">
                                                <tr>
                                                    <th>작업일</th>
                                                    <th>유형</th>
                                                    <th>요약</th>
                                                    <th>등록자</th>
                                                    <th class="text-center">파일</th>
                                                    <th class="text-center">관리</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                {% for w in work_rows %}
                                                <tr style="cursor: pointer;" onclick="openWorkDetail({{ w.Work_ID }})">
                                                    <td>{{ w.Work_Date }}</td>
                                                    <td>
                            <span class="badge bg-secondary bg-opacity-10 text-dark border">
                                {{ w.Work_Type }}
                            </span>
                                                    </td>
                                                    <td class="text-truncate" style="max-width: 300px;">
                                                        {{ w.Summary }}
                                                    </td>
                                                    <td>{{ w.Submitter }}</td>
                                                    <td class="text-center">
                                                        {% if w.Attachment_YN == 'Y' %}
                                                        <i class="bi bi-paperclip text-primary"></i>
                                                        {% endif %}
                                                    </td>
                                                    <td class="text-center" onclick="event.stopPropagation();">
                                                        <div class="d-flex justify-content-center gap-1">
                                                            <button class="btn btn-sm btn-outline-secondary"
                                                                    onclick="openWorkEditModal({{ w.Work_ID }})">
                                                                <i class="bi bi-pencil-fill"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-danger"
                                                                    onclick="deleteWork({{ w.Work_ID }})">
                                                                <i class="bi bi-trash-fill"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                {% else %}
                                                <tr>
                                                    <td colspan="6" class="text-center py-5 text-muted">
                                                        <div class="mb-2"><i class="bi bi-journal-x fs-1"></i></div>
                                                        <div>등록된 작업 이력이 없습니다.</div>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="modal fade" id="customerEditModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <form id="customerEditForm">
                        <div class="modal-content bg-light">
                            <div class="modal-header bg-white border-bottom-0 shadow-sm py-3">
                                <h5 class="modal-title fw-bold text-primary">
                                    <i class="bi bi-pencil-square me-2"></i>고객 정보 수정
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="닫기"></button>
                            </div>

                            <div class="modal-body p-4" style="max-height: 70vh; overflow-y: auto;">
                                <input type="hidden" id="cust_person_id" name="person_id"
                                       value="{{ people.Person_ID }}">

                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-white border-bottom fw-bold text-dark">
                                        <i class="bi bi-person-badge me-1"></i> 기본 정보 및 설정
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <div class="form-floating">
                                                    <input type="text" class="form-control" id="company" name="company"
                                                           value="{{ people.Company or '' }}" placeholder="고객명">
                                                    <label for="company" class="fw-bold text-primary">고객사명
                                                        (Company)</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-floating">
                                                    <input type="text" class="form-control" id="industry_category"
                                                           name="industry_category"
                                                           value="{{ people.Business_Type or '' }}"
                                                           placeholder="업종 분류">
                                                    <label for="industry_category">업종 분류</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-floating">
                                                    <input type="text" class="form-control" id="industry_detail"
                                                           name="industry_detail"
                                                           value="{{ people.Business_Detail or '' }}"
                                                           placeholder="업종 세부">
                                                    <label for="industry_detail">업종 세부</label>
                                                </div>
                                            </div>

                                            <div class="col-md-4">
                                                <div class="form-floating">
                                                    <select class="form-select" id="client_sensitivity"
                                                            name="client_sensitivity">
                                                        <option value="1" {% if people.Client_Sensitivity|string==
                                                        '1' %}selected{% endif %}>표준</option>
                                                        <option value="0" {% if people.Client_Sensitivity|string==
                                                        '0' %}selected{% endif %}>민감</option>
                                                        <option value="2" {% if people.Client_Sensitivity|string==
                                                        '2' %}selected{% endif %}>VIP</option>
                                                    </select>
                                                    <label for="client_sensitivity">고객 민감도</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-floating">
                                                    <select class="form-select" id="report_yn" name="report_yn">
                                                        <option value="0" {% if people.Report_YN|string==
                                                        '0' %}selected{% endif %}>Y</option>
                                                        <option value="1" {% if people.Report_YN|string==
                                                        '1' %}selected{% endif %}>N</option>
                                                    </select>
                                                    <label for="report_yn">정기 레포트 발송</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-floating">
                                                    <input type="text" class="form-control" name="sales_manager"
                                                           value="{{ people.Sales_Manager or '' }}" placeholder="영업담당">
                                                    <label>영업 담당자</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-white border-bottom fw-bold text-dark">
                                        <i class="bi bi-geo-alt me-1"></i> 위치 및 접속 정보
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <div class="form-floating">
                                                    <select class="form-select" id="dc_location" name="dc_location">
                                                        <option value="목동1" {% if people.IDC|string==
                                                        '0' %}selected{% endif %}>목동1</option>
                                                        <option value="목동2" {% if people.IDC|string==
                                                        '1' %}selected{% endif %}>목동2</option>
                                                        <option value="용산" {% if people.IDC|string==
                                                        '2' %}selected{% endif %}>용산</option>
                                                        <option value="여의도" {% if people.IDC|string==
                                                        '3' %}selected{% endif %}>여의도</option>
                                                        <option value="강남" {% if people.IDC|string==
                                                        '4' %}selected{% endif %}>강남</option>
                                                        <option value="분당" {% if people.IDC|string==
                                                        '5' %}selected{% endif %}>분당</option>
                                                        <option value="천안" {% if people.IDC|string==
                                                        '6' %}selected{% endif %}>천안</option>
                                                        <option value="송정" {% if people.IDC|string==
                                                        '7' %}selected{% endif %}>송정</option>
                                                        <option value="대구" {% if people.IDC|string==
                                                        '8' %}selected{% endif %}>대구</option>
                                                        <option value="대전" {% if people.IDC|string==
                                                        '8' %}selected{% endif %}>대전</option>
                                                    </select>
                                                    <label>DC (데이터센터)</label>
                                                </div>
                                            </div>
                                            <div class="col-md-8">
                                                <div class="form-floating">
                                                    <input type="text" class="form-control" name="rack_location"
                                                           value="{{ people.Rack_Location or '' }}" placeholder="위치">
                                                    <label>Rack 위치</label>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-floating">
                                        <textarea class="form-control" name="service_url" placeholder="URL"
                                                  style="height: 80px;">{{ people.Service_URL__c or '' }}</textarea>
                                                    <label>서비스 URL</label>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-floating">
                                                    <input type="text" class="form-control" name="customer_folder"
                                                           value="{{ people.Customer_Folder or '' }}"
                                                           placeholder="폴더 경로">
                                                    <label>고객 폴더 경로</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-white border-bottom fw-bold text-dark">
                                        <i class="bi bi-hdd-network me-1"></i> 부가 서비스 설정
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-3">
                                                <div class="form-floating">
                                                    <select class="form-select" name="backup_service_yn">
                                                        <option value="n" {% if people.Backup_Service==
                                                        'n' %}selected{% endif %}>미사용</option>
                                                        <option value="y" {% if people.Backup_Service==
                                                        'y' %}selected{% endif %}>사용함</option>
                                                    </select>
                                                    <label>백업 사용 여부</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-floating">
                                                    <input type="text" class="form-control" name="backup_vendor"
                                                           value="{{ people.Backup_Vendor or '' }}" placeholder="백업 업체">
                                                    <label>백업 업체</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-floating">
                                                    <select class="form-select" id="backup_type" name="backup_type">
                                                        <option value="">유형 선택</option>
                                                        <option value="0" {% if people.Backup_Type|string==
                                                        '0' %}selected{% endif %}>원격 (전체)</option>
                                                        <option value="1" {% if people.Backup_Type|string==
                                                        '1' %}selected{% endif %}>원격 (DB)</option>
                                                        <option value="2" {% if people.Backup_Type|string==
                                                        '2' %}selected{% endif %}>원격 (File)</option>
                                                        <option value="3" {% if people.Backup_Type|string==
                                                        '3' %}selected{% endif %}>로컬 (전체)</option>
                                                        <option value="4" {% if people.Backup_Type|string==
                                                        '4' %}selected{% endif %}>로컬 (DB)</option>
                                                        <option value="5" {% if people.Backup_Type|string==
                                                        '5' %}selected{% endif %}>로컬 (File)</option>
                                                        <option value="6" {% if people.Backup_Type|string==
                                                        '6' %}selected{% endif %}>소산 백업</option>
                                                        <option value="7" {% if people.Backup_Type|string==
                                                        '7' %}selected{% endif %}>원격 + 소산</option>
                                                        <option value="8" {% if people.Backup_Type|string==
                                                        '8' %}selected{% endif %}>로컬 + 소산</option>
                                                    </select>
                                                    <label for="backup_type">백업 유형</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-floating">
                                                    <input type="text" class="form-control" name="backup_period_volume"
                                                           value="{{ people.Backup_Period or '' }}" placeholder="주기/용량">
                                                    <label>주기 및 용량</label>
                                                </div>
                                            </div>
                                            <div class="col-md-8">
                                                <div class="form-floating">
                                                    <input type="text" class="form-control" name="backup_path"
                                                           value="{{ people.Backup_Path or '' }}" placeholder="경로">
                                                    <label>백업 경로</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-floating">
                                                    <input type="text" class="form-control" id="vaccine_yn"
                                                           name="vaccine_yn"
                                                           value="{{ people.Vaccine__c or '' }}" placeholder="백신">
                                                    <label for="vaccine_yn">보안 백신</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-floating">
                                                    <input type="text" class="form-control" id="shell_monitor_yn"
                                                           name="shell_monitor_yn"
                                                           value="{{ people.ShellMonitor__c or '' }}"
                                                           placeholder="쉘 모니터링">
                                                    <label for="shell_monitor_yn">쉘 모니터링</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-white border-bottom fw-bold text-dark">
                                        <i class="bi bi-journal-text me-1"></i> 특이사항 및 메모
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <div class="form-floating">
                                        <textarea class="form-control" id="customer_notes" name="customer_notes"
                                                  style="height: 100px">{{ people.chEtc or '' }}</textarea>
                                                    <label for="customer_notes">고객 특이사항</label>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-floating">
                                                    <textarea class="form-control" name="intrusion_notes"
                                                              style="height: 80px">{{ people.chHistory or '' }}</textarea>
                                                    <label>침탐 특이사항</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modal-footer bg-white shadow-sm border-top-0 py-3">
                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
                                <button type="button" class="btn btn-primary px-4 fw-bold"
                                        onclick="updateCustomerInfo()">
                                    <i class="bi bi-save me-1"></i> 변경사항 저장
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="modal fade" id="workCreateModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title fw-bold">작업 등록</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>

                        <form id="workCreateForm">
                            <div class="modal-body p-4">
                                <input type="hidden" name="person_id" value="{{ people.Person_ID }}">

                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label small fw-bold">작업일 *</label>
                                        <input type="date" class="form-control" name="work_date" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label small fw-bold">유형 *</label>
                                        <select class="form-select" name="work_type" required>
                                            <option value="보안장비 변경">보안장비 변경</option>
                                            <option value="오더 정보">오더 정보</option>
                                            <option value="고객명 변경">고객명 변경</option>
                                            <option value="보안장비 이중화">보안장비 이중화</option>
                                            <option value="레포트">레포트</option>
                                            <option value="기타">기타</option>
                                        </select>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label small fw-bold">요약</label>
                                        <input type="text" class="form-control" name="summary">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label small fw-bold">상세정보</label>
                                        <textarea class="form-control" name="description" rows="5"></textarea>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label small fw-bold">첨부파일</label>
                                        <input type="file" class="form-control" name="files[]" multiple>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
                                <button type="button" class="btn btn-primary" onclick="createWork()">등록</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="workEditModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title fw-bold">작업 수정</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <form id="workEditForm">
                            <div class="modal-body p-4">
                                <input type="hidden" id="edit_work_id">

                                <div id="editLoading" class="text-center py-5">
                                    <div class="spinner-border text-primary" role="status"></div>
                                </div>

                                <div id="editContent" style="display: none;">
                                    <input type="hidden" id="edit_person_id" name="person_id">

                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label small fw-bold">작업일</label>
                                            <input type="date" class="form-control" id="edit_work_date" name="work_date"
                                                   required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label small fw-bold">유형</label>
                                            <select class="form-select" id="edit_work_type" name="work_type" required>
                                                <option value="보안장비 변경">보안장비 변경</option>
                                                <option value="오더 정보">오더 정보</option>
                                                <option value="고객명 변경">고객명 변경</option>
                                                <option value="보안장비 이중화">보안장비 이중화</option>
                                                <option value="레포트">레포트</option>
                                                <option value="기타">기타</option>
                                            </select>
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label small fw-bold">요약</label>
                                            <input type="text" class="form-control" id="edit_summary" name="summary">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label small fw-bold">상세정보</label>
                                            <textarea class="form-control" id="edit_description" name="description"
                                                      rows="5"></textarea>
                                        </div>

                                        <div class="col-12">
                                            <label class="form-label small fw-bold">기존 첨부파일</label>
                                            <div id="edit_file_list" class="bg-light p-3 rounded border">
                                                <span class="text-muted small">파일 없음</span>
                                            </div>
                                        </div>

                                        <div class="col-12">
                                            <label class="form-label small fw-bold text-primary">파일 추가</label>
                                            <input type="file" class="form-control" name="files[]" multiple>
                                            <div class="form-text small">파일을 선택하면 기존 파일에 추가됩니다.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
                                <button type="button" class="btn btn-primary" onclick="updateWork()">수정 저장</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="workDetailModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title fw-bold">작업 상세 정보</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body p-4" id="workDetailBody">
                            <div class="text-center py-5">
                                <div class="spinner-border text-primary"></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="custDetailModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content border-0 shadow">
                        <div class="modal-header border-0 pb-0">
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body pt-0 pb-4 px-4 bg-light">

                            <div class="card border-0 shadow-sm mb-3 mt-2 overflow-hidden">
                                <div class="card-body position-relative">
                                    <div class="position-absolute top-0 end-0 mt-3 me-3">
                                        <span class="badge rounded-pill px-3 py-2" id="cust_view_status">-</span>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-flex align-items-center justify-content-center me-3"
                                             style="width: 56px; height: 56px;">
                                            <i class="bi bi-hdd-rack-fill fs-3"></i>
                                        </div>
                                        <div>
                                            <h4 class="fw-bold text-dark mb-1" id="cust_view_name">-</h4>
                                            <div class="text-muted small"><i class="bi bi-building me-1"></i><span
                                                    id="cust_view_customer">-</span></div>
                                        </div>
                                    </div>
                                    <div class="d-flex gap-2 mt-3">
                                        <div class="bg-light border rounded px-3 py-2">
                                            <span class="text-secondary small fw-bold d-block">IP Address</span>
                                            <span class="font-monospace text-dark fw-bold" id="cust_view_ip">-</span>
                                        </div>
                                        <div class="bg-light border rounded px-3 py-2">
                                            <span class="text-secondary small fw-bold d-block">Serial Number</span>
                                            <span class="font-monospace text-dark" id="cust_view_serial">-</span>
                                        </div>
                                        <div class="bg-light border rounded px-3 py-2 flex-grow-1">
                                            <span class="text-secondary small fw-bold d-block">Category</span>
                                            <span class="text-dark" id="cust_view_category">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="card border-0 shadow-sm h-100">
                                        <div class="card-header bg-white border-bottom-0 fw-bold text-secondary">
                                            <i class="bi bi-cpu me-2"></i>하드웨어 정보
                                        </div>
                                        <div class="card-body pt-0">
                                            <table class="table table-borderless table-sm mb-0 small">
                                                <tr>
                                                    <td class="text-muted" style="width:35%;">제조사</td>
                                                    <td class="fw-bold" id="cust_view_maker">-</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-muted">제품명</td>
                                                    <td id="cust_view_product">-</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-muted">모델명</td>
                                                    <td id="cust_view_model">-</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card border-0 shadow-sm h-100">
                                        <div class="card-header bg-white border-bottom-0 fw-bold text-secondary">
                                            <i class="bi bi-activity me-2"></i>운영 및 관리
                                        </div>
                                        <div class="card-body pt-0">
                                            <table class="table table-borderless table-sm mb-0 small">
                                                <tr>
                                                    <td class="text-muted" style="width:35%;">운영 모드</td>
                                                    <td><span class="badge bg-light text-dark border"
                                                              id="cust_view_mode">-</span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="text-muted">운영 업체</td>
                                                    <td id="cust_view_op_comp">-</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-muted">유지보수</td>
                                                    <td id="cust_view_maint">-</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-muted">DC 위치</td>
                                                    <td id="cust_view_idc">-</td>
                                                </tr>
                                                <tr>
                                                    <td class="text-muted">공급자</td>
                                                    <td id="cust_view_supplier">-</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-body">
                                            <h6 class="fw-bold text-secondary small mb-3"><i
                                                    class="bi bi-calendar-event me-2"></i>상세
                                                일정 정보</h6>
                                            <div class="row g-3 small">
                                                <div class="col-6 d-flex justify-content-between border-bottom pb-2">
                                                    <span class="text-muted">구매일 (Purchase)</span><span
                                                        class="fw-bold text-dark"
                                                        id="cust_view_purchase">-</span>
                                                </div>
                                                <div class="col-6 d-flex justify-content-between border-bottom pb-2">
                                                    <span class="text-muted">입고일 (Receive)</span><span
                                                        class="fw-bold text-primary"
                                                        id="cust_view_receive">-</span>
                                                </div>
                                                <div class="col-6 d-flex justify-content-between border-bottom pb-2">
                                                    <span class="text-muted">설치일 (Install)</span><span
                                                        class="fw-bold text-dark"
                                                        id="cust_view_install">-</span>
                                                </div>
                                                <div class="col-6 d-flex justify-content-between border-bottom pb-2">
                                                    <span class="text-muted">반환일 (Return)</span><span
                                                        class="fw-bold text-dark"
                                                        id="cust_view_return">-</span>
                                                </div>
                                                <div class="col-6 d-flex justify-content-between">
                                                    <span class="text-muted">폐기일 (Disposal)</span><span
                                                        class="fw-bold text-secondary" id="cust_view_disposal">-</span>
                                                </div>
                                                <div class="col-6 d-flex justify-content-between">
                                                    <span class="text-muted">라이선스 만료</span><span
                                                        class="fw-bold text-danger"
                                                        id="cust_view_license">-</span>
                                                </div>
                                            </div>
                                            <hr class="dashed my-3">
                                            <div class="row">
                                                <div class="col-12">
                                                    <h6 class="fw-bold text-secondary small mb-2"><i
                                                            class="bi bi-arrow-repeat me-2"></i>백업 설정</h6>
                                                    <span class="badge bg-light text-dark border me-2"
                                                          id="cust_view_backup">-</span>
                                                    <span class="text-muted small me-2" id="cust_view_cycle">-</span>
                                                    <span class="text-muted small fst-italic"
                                                          id="cust_view_note"></span>
                                                </div>
                                            </div>
                                            <div class="mt-3 p-2 bg-light rounded small" id="cust_view_desc"
                                                 style="white-space: pre-wrap;">-
                                            </div>

                                            <div class="text-end mt-3 border-top pt-2">
                                    <span class="text-muted small me-3">최초 등록: <span class="fw-bold text-dark"
                                                                                     id="cust_view_submitter">-</span></span>
                                                <span class="text-muted small">최종 수정: <span class="fw-bold text-dark"
                                                                                            id="cust_view_updated">-</span></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 pt-0 pb-4 pe-4 bg-light">
                            <button type="button" class="btn btn-white border shadow-sm px-4" data-bs-dismiss="modal">
                                닫기
                            </button>
                            <button type="button" class="btn btn-primary shadow-sm px-4" id="btnCustEditFromDetail">
                                <i class="bi bi-pencil-square me-2"></i>정보 수정
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="custAssetModal" tabindex="-1" data-bs-backdrop="static">
                <div class="modal-dialog modal-dialog-scrollable modal-lg">
                    <form class="modal-content" id="custAssetForm">
                        <input type="hidden" id="cust_asset_id" name="asset_id">
                        <input type="hidden" name="person_id" value="{{ people.Person_ID }}">

                        <div class="modal-header">
                            <h5 class="modal-title fw-bold" id="assetModalTitle">보안장비 관리</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>

                        <div class="modal-body bg-light p-4">
                            <div class="alert alert-info small mb-4 border-0 shadow-sm">
                                <i class="bi bi-info-circle-fill me-1"></i>
                                필수 항목(<span class="text-danger fw-bold">*</span>)만 입력하면 등록됩니다.
                            </div>

                            <div class="card border-0 shadow-sm mb-4">
                                <div class="card-body">
                                    <h6 class="fw-bold mb-3 text-secondary"><i class="bi bi-building me-1"></i>기본 정보
                                    </h6>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label small fw-bold">고객사</label>
                                            <input type="text" class="form-control bg-light"
                                                   value="{{ people.Company }}" readonly>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label small fw-bold text-primary">사이트명 <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" class="form-control border-primary" name="owner_name"
                                                   id="cust_owner_name"
                                                   placeholder="예: 게임물관리위원회(목동)" required>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="accordion" id="custAccordion">

                                <div class="accordion-item border shadow-sm mb-2 rounded overflow-hidden">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button fw-bold text-dark small" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#colCustSpec">
                                            <i class="bi bi-router me-2"></i>장비 정보
                                        </button>
                                    </h2>
                                    <div id="colCustSpec" class="accordion-collapse collapse show"
                                         data-bs-parent="#custAccordion">
                                        <div class="accordion-body bg-light border-top">
                                            <div class="row g-3 mb-3">
                                                <div class="col-md-6"><label
                                                        class="form-label small fw-bold text-secondary">CI 이름
                                                    <span class="text-danger">*</span></label><input type="text"
                                                                                                     class="form-control"
                                                                                                     name="ci_name"
                                                                                                     id="cust_ci_name"
                                                                                                     required>
                                                </div>
                                                <div class="col-md-6"><label
                                                        class="form-label small fw-bold text-secondary">공급자
                                                    <span class="text-danger">*</span></label><select
                                                        class="form-select select2-cust" name="supplier"
                                                        id="cust_supplier" required
                                                        style="width:100%;">
                                                    <option value="">선택</option>
                                                    <option value="ICTIS">ICTIS</option>
                                                    <option value="고객소유">고객소유</option>
                                                    <option value="기타">기타</option>
                                                    <option value="임대">임대</option>
                                                    <option value="펜타시큐리티">펜타시큐리티</option>
                                                </select></div>
                                            </div>
                                            <div class="row g-3 mb-3">
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">계층
                                                    1</label><select class="form-select" name="category"
                                                                     id="cust_category">
                                                    <option value="보안장비">보안장비</option>
                                                    <option value="보안장비_VIP">보안장비_VIP</option>
                                                </select></div>
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">계층 2
                                                    <span class="text-danger">*</span></label><select
                                                        class="form-select select2-cust" name="type" id="cust_type"
                                                        required
                                                        style="width:100%;">
                                                    <option value="">선택</option>
                                                    <option value="방화벽">방화벽</option>
                                                    <option value="방화벽_VIP">방화벽_VIP</option>
                                                    <option value="NGFW">NGFW</option>
                                                    <option value="웹방화벽">웹방화벽</option>
                                                    <option value="스위치">스위치</option>
                                                    <option value="UTM">UTM</option>
                                                    <option value="UTM_VIP">UTM_VIP</option>
                                                    <option value="IPS">IPS</option>
                                                    <option value="IDS">IDS</option>
                                                    <option value="DDoS">DDoS</option>
                                                    <option value="VPN">VPN</option>
                                                    <option value="라우터">라우터</option>
                                                    <option value="스팸스나이퍼">스팸스나이퍼</option>
                                                    <option value="스팸스나이퍼_VIP">스팸스나이퍼_VIP</option>
                                                    <option value="웹키퍼">웹키퍼</option>
                                                    <option value="로그서버">로그서버</option>
                                                    <option value="암호화솔루션">암호화솔루션</option>
                                                    <option value="기타">기타</option>
                                                </select></div>
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">계층
                                                    3</label><select class="form-select select2-cust" name="item"
                                                                     id="cust_item"
                                                                     style="width:100%;">
                                                    <option value="">선택</option>
                                                    <option value="Fortinet">Fortinet</option>
                                                    <option value="Ahnlab">Ahnlab</option>
                                                    <option value="Wapples">Wapples</option>
                                                    <option value="Secui">Secui</option>
                                                    <option value="Juniper">Juniper</option>
                                                    <option value="Cisco">Cisco</option>
                                                    <option value="EX">EX</option>
                                                    <option value="F5">F5</option>
                                                    <option value="FortiDDoS">FortiDDoS</option>
                                                    <option value="FTG">FTG</option>
                                                    <option value="FutureSystems">FutureSystems</option>
                                                    <option value="HansolNexG">HansolNexG</option>
                                                    <option value="HP">HP</option>
                                                    <option value="ICTIS">ICTIS</option>
                                                    <option value="ISG">ISG</option>
                                                    <option value="iwall">iwall</option>
                                                    <option value="L4">L4</option>
                                                    <option value="L4 Alteon 180E">L4 Alteon 180E</option>
                                                    <option value="L4 PumPkin">L4 PumPkin</option>
                                                    <option value="MF2">MF2</option>
                                                    <option value="MFI">MFI</option>
                                                    <option value="Monitorapp">Monitorapp</option>
                                                    <option value="NE">NE</option>
                                                    <option value="Paloalto">Paloalto</option>
                                                    <option value="Penta">Penta</option>
                                                    <option value="Piolink">Piolink</option>
                                                    <option value="PulseSecure">PulseSecure</option>
                                                    <option value="RUCKUS">RUCKUS</option>
                                                    <option value="SG2024">SG2024</option>
                                                    <option value="Sniper">Sniper</option>
                                                    <option value="SRX">SRX</option>
                                                    <option value="SSG">SSG</option>
                                                    <option value="TG">TG</option>
                                                    <option value="TrendMicro">TrendMicro</option>
                                                    <option value="UTM_VIP">UTM_VIP</option>
                                                    <option value="VIP">VIP</option>
                                                    <option value="Web Front">Web Front</option>
                                                    <option value="Wins">Wins</option>
                                                    <option value="XIOS">XIOS</option>
                                                    <option value="로그서버">로그서버</option>
                                                    <option value="방화벽_VIP">방화벽_VIP</option>
                                                    <option value="스팸스나이퍼">스팸스나이퍼</option>
                                                    <option value="스팸스나이퍼_VIP">스팸스나이퍼_VIP</option>
                                                    <option value="웹키퍼">웹키퍼</option>
                                                </select></div>
                                            </div>
                                            <div class="row g-3">
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">제품명</label><input
                                                        type="text" class="form-control" name="product_name"
                                                        id="cust_product_name">
                                                </div>
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">모델</label><input
                                                        type="text"
                                                        class="form-control"
                                                        name="model_number"
                                                        id="cust_model_number">
                                                </div>
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">제조사</label><input
                                                        type="text" class="form-control" name="manufacturer_name"
                                                        id="cust_manufacturer_name"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item border shadow-sm mb-2 rounded overflow-hidden">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed fw-bold text-dark small" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#colCustOp">
                                            <i class="bi bi-tools me-2"></i>운영 및 백업
                                        </button>
                                    </h2>
                                    <div id="colCustOp" class="accordion-collapse collapse"
                                         data-bs-parent="#custAccordion">
                                        <div class="accordion-body bg-light border-top">
                                            <div class="row g-3 mb-3">
                                                <div class="col-md-6"><label
                                                        class="form-label small fw-bold text-secondary">유지보수</label><select
                                                        class="form-select select2-cust" name="maintenance_company"
                                                        id="cust_maintenance_company" style="width:100%;">
                                                    <option value="12">없음</option>
                                                    <option value="0">ICTIS</option>
                                                    <option value="11">고객사 유지보수</option>
                                                    <option value="1">에스에이정보기술</option>
                                                    <option value="2">블루시큐어</option>
                                                    <option value="3">유콘텍</option>
                                                    <option value="4">유니포인트</option>
                                                    <option value="5">엔큐리티</option>
                                                    <option value="6">시큐트러스트</option>
                                                    <option value="7">모니터랩</option>
                                                    <option value="8">인스테크</option>
                                                    <option value="9">쿼리시스템즈</option>
                                                    <option value="10">에스디씨디엠</option>
                                                    <option value="13">윈스</option>
                                                </select></div>
                                                <div class="col-md-6"><label
                                                        class="form-label small fw-bold text-secondary">운영업체</label><select
                                                        class="form-select" name="operation_company"
                                                        id="cust_operation_company">
                                                    <option value="0">ICTIS</option>
                                                    <option value="1">고객사</option>
                                                </select></div>
                                                <div class="col-md-6"><label
                                                        class="form-label small fw-bold text-secondary">운영모드</label><select
                                                        class="form-select" name="operation_mode"
                                                        id="cust_operation_mode">
                                                    <option value="0">해당 없음</option>
                                                    <option value="1">탐지</option>
                                                    <option value="2">차단</option>
                                                </select></div>
                                                <div class="col-md-6"><label
                                                        class="form-label small fw-bold text-secondary">DC</label><input
                                                        type="text"
                                                        class="form-control"
                                                        name="idc_site"
                                                        id="cust_idc_site">
                                                </div>
                                            </div>
                                            <hr class="dashed my-2">
                                            <div class="row g-3">
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">백업
                                                    여부</label><select class="form-select" name="c_backup"
                                                                      id="cust_c_backup">
                                                    <option value="0">YES</option>
                                                    <option value="1">NO</option>
                                                </select></div>
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">주기</label><select
                                                        class="form-select" name="c_cycle" id="cust_c_cycle">
                                                    <option value="0">Daily</option>
                                                    <option value="1">Weekly</option>
                                                    <option value="2">Monthly</option>
                                                </select></div>
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">백업
                                                    특이사항</label><input type="text" class="form-control" name="cfg_note"
                                                                       id="cust_cfg_note"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item border shadow-sm rounded overflow-hidden">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button collapsed fw-bold text-dark small" type="button"
                                                data-bs-toggle="collapse" data-bs-target="#colCustStatus">
                                            <i class="bi bi-calendar-check me-2"></i>식별 및 날짜
                                        </button>
                                    </h2>
                                    <div id="colCustStatus" class="accordion-collapse collapse"
                                         data-bs-parent="#custAccordion">
                                        <div class="accordion-body bg-light border-top">
                                            <div class="row g-3 mb-3">
                                                <div class="col-md-6"><label
                                                        class="form-label small fw-bold text-secondary">S/N</label><input
                                                        type="text" class="form-control" name="serial_number"
                                                        id="cust_serial_number"></div>
                                                <div class="col-md-6"><label
                                                        class="form-label small fw-bold text-secondary">IP</label><input
                                                        type="text"
                                                        class="form-control font-monospace"
                                                        name="ip_address"
                                                        id="cust_ip_address">
                                                </div>
                                                <div class="col-12"><label
                                                        class="form-label small fw-bold text-secondary">장비
                                                    특이사항</label><textarea class="form-control" name="ci_note"
                                                                          id="cust_ci_note"
                                                                          rows="2"></textarea></div>
                                            </div>
                                            <hr class="dashed my-2">
                                            <div class="row g-3">
                                                <div class="col-12"><label
                                                        class="form-label small fw-bold text-secondary">상태</label><select
                                                        class="form-select" name="lifecycle_status"
                                                        id="cust_lifecycle_status">
                                                    <option value="3">사용중</option>
                                                    <option value="0">주문됨</option>
                                                    <option value="1">입고됨</option>
                                                    <option value="11">폐기</option>
                                                </select></div>

                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">구매일</label><input
                                                        type="date" class="form-control" name="purchase_date"
                                                        id="cust_purchase_date"></div>
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">입고일</label><input
                                                        type="date" class="form-control" name="receive_date"
                                                        id="cust_receive_date">
                                                </div>
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">설치일</label><input
                                                        type="date" class="form-control" name="installation_date"
                                                        id="cust_installation_date"></div>
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">반환일</label><input
                                                        type="date" class="form-control" name="return_date"
                                                        id="cust_return_date">
                                                </div>
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">라이선스
                                                    만료일</label><input type="date" class="form-control"
                                                                      name="license_expiry"
                                                                      id="cust_license_expiry"></div>
                                                <div class="col-md-4"><label
                                                        class="form-label small fw-bold text-secondary">폐기일</label><input
                                                        type="date" class="form-control" name="disposal_date"
                                                        id="cust_disposal_date"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-3">
                                <label class="form-label small fw-bold text-secondary">비고</label>
                                <textarea class="form-control" name="description" id="cust_description"
                                          rows="2"></textarea>
                            </div>
                        </div>

                        <div class="modal-footer bg-white border-top-0">
                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
                            <button type="button" class="btn btn-primary px-4 fw-bold" onclick="saveCustAsset()">
                                <i class="bi bi-check-lg me-1"></i> 저장하기
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <!-- 서버 추가 모달 -->
            <div class="modal fade" id="serverAddModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable modal-lg">
                    <div class="modal-content">
                        <div class="modal-header bg-white border-bottom py-3">
                            <h5 class="modal-title fw-bold">
                                <i class="bi bi-hdd-network text-primary me-2"></i>서버 추가
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>

                        <form id="serverAddForm">
                            <div class="modal-body bg-light p-4">
                                <input type="hidden" id="server_person_id" value="{{ people.Person_ID }}">

                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <label class="form-label fw-bold small text-secondary mb-0">서버 목록 입력</label>
                                    <button type="button" class="btn btn-sm btn-outline-primary bg-white shadow-sm"
                                            onclick="addServerRow()">
                                        <i class="bi bi-plus-lg me-1"></i>행 추가
                                    </button>
                                </div>

                                <div id="serverEntryContainer">
                                    <div class="card border-0 shadow-sm mb-2 server-row">
                                        <div class="card-body p-2">
                                            <div class="row g-2 align-items-center">
                                                <div class="col-6">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control border-0 bg-light"
                                                               name="server_names[]" placeholder="서버명" required>
                                                        <label>서버명 <span class="text-danger">*</span></label>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="form-floating">
                                                        <input type="text" class="form-control border-0 bg-light"
                                                               name="server_ips[]" placeholder="IP 주소">
                                                        <label>서버 IP</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-text mt-2 small text-end">
                                    <i class="bi bi-info-circle me-1"></i>+ 버튼을 눌러 여러 대를 한 번에 등록할 수 있습니다.
                                </div>
                            </div>
                            <div class="modal-footer bg-white border-top-0 py-3">
                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
                                <button type="button" class="btn btn-primary px-4 fw-bold" onclick="addServer()">
                                    <i class="bi bi-check-lg me-1"></i> 일괄 등록
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="serverEditModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title fw-bold">서버 정보 수정</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <form id="serverEditForm">
                            <div class="modal-body bg-light p-4" id="serverEditBody">
                            </div>
                            <div class="modal-footer bg-white border-top-0">
                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">닫기</button>
                                <button type="button" class="btn btn-primary fw-bold" onclick="updateServer()">저장
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- 서버 삭제 모달 -->
            <div class="modal fade" id="serverDeleteModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <form class="modal-content" id="serverDeleteForm" method="POST">
                        <div class="modal-header border-bottom-0 pb-0">
                            <h5 class="modal-title fw-bold text-danger">
                                <i class="bi bi-exclamation-triangle-fill me-2"></i>서버 삭제
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
                        </div>
                        <div class="modal-body py-4">
                            <p class="mb-1 text-secondary">정말 이 서버 정보를 삭제하시겠습니까?</p>
                            <div class="fw-bold fs-5 text-dark" id="deleteTargetName">Server Name</div>
                        </div>
                        <div class="modal-footer border-top-0 pt-0">
                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
                            <button type="submit" class="btn btn-danger fw-bold">
                                <i class="bi bi-trash-fill me-1"></i>삭제하기
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <!--담당자 추가-->
            <div class="modal fade" id="contactAddModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header bg-white border-bottom py-3">
                            <h5 class="modal-title fw-bold">담당자 추가</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <form id="contactAddForm">
                            <div class="modal-body bg-light p-4">
                                <input type="hidden" id="contact_person_id" value="{{ people.Person_ID }}">

                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label small fw-bold text-secondary">정/부</label>
                                        <select class="form-select" name="role_type">
                                            <option value="정">정</option>
                                            <option value="부">부</option>
                                        </select>
                                    </div>
                                    <div class="col-md-8">
                                        <label class="form-label small fw-bold text-secondary">이름 *</label>
                                        <input type="text" class="form-control" name="name" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label small fw-bold text-secondary">일반전화</label>
                                        <input type="text" class="form-control" name="general_phone">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label small fw-bold text-secondary">휴대폰번호</label>
                                        <input type="text" class="form-control" name="phone">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label small fw-bold text-secondary">이메일</label>
                                        <input type="email" class="form-control" name="email">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label small fw-bold text-secondary">상태</label>
                                        <select class="form-select" name="status">
                                            <option value="활성화">활성화</option>
                                            <option value="비활성화">비활성화</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label small fw-bold text-secondary">침탐수신</label>
                                        <select class="form-select" name="sms_yn">
                                            <option value="아니오">아니오</option>
                                            <option value="예">예</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label small fw-bold text-secondary">보고서수신</label>
                                        <select class="form-select" name="report_yn">
                                            <option value="아니오">아니오</option>
                                            <option value="예">예</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer bg-white border-top-0">
                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
                                <button type="button" class="btn btn-primary fw-bold" onclick="addContact()">등록</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="contactEditModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header bg-white border-bottom py-3">
                            <h5 class="modal-title fw-bold">담당자 수정</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <form id="contactEditForm">
                            <div class="modal-body bg-light p-4">
                                <input type="hidden" id="edit_contact_id">

                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label small fw-bold text-secondary">정/부</label>
                                        <select class="form-select" id="edit_role_type" name="role_type">
                                            <option value="정">정</option>
                                            <option value="부">부</option>
                                        </select>
                                    </div>
                                    <div class="col-md-8">
                                        <label class="form-label small fw-bold text-secondary">이름 *</label>
                                        <input type="text" class="form-control" id="edit_name" name="name" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label small fw-bold text-secondary">일반전화</label>
                                        <input type="text" class="form-control" id="edit_general_phone"
                                               name="general_phone">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label small fw-bold text-secondary">휴대폰번호</label>
                                        <input type="text" class="form-control" id="edit_phone" name="phone">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label small fw-bold text-secondary">이메일</label>
                                        <input type="email" class="form-control" id="edit_email" name="email">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label small fw-bold text-secondary">상태</label>
                                        <select class="form-select" id="edit_status" name="status">
                                            <option value="활성화">활성화</option>
                                            <option value="비활성화">비활성화</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label small fw-bold text-secondary">침탐수신</label>
                                        <select class="form-select" id="edit_sms_yn" name="sms_yn">
                                            <option value="아니오">아니오</option>
                                            <option value="예">예</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label small fw-bold text-secondary">보고서수신</label>
                                        <select class="form-select" id="edit_report_yn" name="report_yn">
                                            <option value="아니오">아니오</option>
                                            <option value="예">예</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer bg-white border-top-0">
                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
                                <button type="button" class="btn btn-primary fw-bold" onclick="updateContact()">수정 저장
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="contactDeleteModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <form class="modal-content" id="contactDeleteForm" method="POST">
                        <div class="modal-header border-bottom-0 pb-0">
                            <h5 class="modal-title fw-bold text-danger">
                                <i class="bi bi-exclamation-triangle-fill me-2"></i>담당자 삭제
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body py-4">
                            <p class="mb-1 text-secondary">정말 이 담당자를 삭제하시겠습니까?</p>
                            <div class="fw-bold fs-5 text-dark" id="deleteContactName">-</div>
                            <p class="small text-muted mt-2 mb-0">선택한 내용이 삭제됩니다.</p>
                        </div>
                        <div class="modal-footer border-top-0 pt-0">
                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
                            <button type="submit" class="btn btn-danger fw-bold">
                                <i class="bi bi-trash-fill me-1"></i>삭제하기
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="modal fade" id="noteModalEtc" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header border-bottom-0">
                            <h5 class="modal-title fw-bold text-danger">고객 특이사항</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body bg-light p-4">
                            <div class="bg-white p-4 rounded border shadow-sm fs-6"
                                 style="white-space: pre-wrap; min-height: 300px;">{{ people.chEtc or '내용 없음' }}
                            </div>
                        </div>
                        <div class="modal-footer border-top-0">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="noteModalHistory" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header border-bottom-0">
                            <h5 class="modal-title fw-bold text-warning">침탐 특이사항</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body bg-light p-4">
                            <div class="bg-white p-4 rounded border shadow-sm fs-6"
                                 style="white-space: pre-wrap; min-height: 300px;">{{ people.chHistory or '내용 없음' }}
                            </div>
                        </div>
                        <div class="modal-footer border-top-0">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="assetDetailModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-scrollable modal-lg">
                    <div class="modal-content">

                        <div class="modal-header bg-white border-bottom py-3">
                            <h5 class="modal-title fw-bold">
                                <i class="bi bi-file-earmark-text text-primary me-2"></i>장비 상세 정보
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
                        </div>

                        <div class="modal-body bg-light p-4">

                            <div class="card border-0 shadow-sm mb-4">
                                <div class="card-body position-relative overflow-hidden">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <div class="mb-2">
                                                <span class="badge rounded-pill px-3 py-2 me-2" id="view_status_badge">상태</span>
                                                <span class="text-muted small fw-bold" id="view_full_category">분류</span>
                                            </div>
                                            <h3 class="fw-bold text-dark mb-1" id="view_name">CI Name</h3>
                                            <div class="text-secondary mt-1">
                                                <i class="bi bi-building me-1"></i><span
                                                    id="view_customer_info">고객사</span>
                                            </div>
                                        </div>
                                        <button type="button" class="btn btn-outline-primary btn-sm"
                                                id="btn_go_to_edit_top">
                                            <i class="bi bi-pencil-square me-1"></i>수정
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="card border shadow-sm mb-4">
                                <div class="card-header bg-white border-bottom-0 pt-3 pb-2">
                                    <h6 class="fw-bold text-primary mb-0"><i class="bi bi-cpu me-2"></i>장비 기본 정보</h6>
                                </div>
                                <div class="card-body pt-0">
                                    <hr class="mt-0 mb-3 text-secondary opacity-25">
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label class="d-block text-secondary small fw-bold mb-1">제조사</label>
                                            <div class="fs-6 text-dark bg-light p-2 rounded" id="view_manufacturer">-
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="d-block text-secondary small fw-bold mb-1">제품명</label>
                                            <div class="fs-6 text-dark bg-light p-2 rounded" id="view_product">-</div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="d-block text-secondary small fw-bold mb-1">모델명 / 버전</label>
                                            <div class="fs-6 text-dark bg-light p-2 rounded" id="view_model">-</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="d-block text-secondary small fw-bold mb-1">일련번호 (S/N)</label>
                                            <div class="fs-6 text-dark bg-light p-2 rounded" id="view_serial">-</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="d-block text-secondary small fw-bold mb-1">IP 정보</label>
                                            <div class="fs-6 text-dark bg-light p-2 rounded" id="view_ip">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card border shadow-sm mb-4">
                                <div class="card-header bg-white border-bottom-0 pt-3 pb-2">
                                    <h6 class="fw-bold text-primary mb-0"><i class="bi bi-tools me-2"></i>운영 및 유지보수</h6>
                                </div>
                                <div class="card-body pt-0">
                                    <hr class="mt-0 mb-3 text-secondary opacity-25">
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <label class="d-block text-secondary small fw-bold mb-1">유지보수업체</label>
                                            <div class="fs-6 text-dark bg-light p-2 rounded" id="view_maint">-</div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="d-block text-secondary small fw-bold mb-1">운영업체</label>
                                            <div class="fs-6 text-dark bg-light p-2 rounded" id="view_op_comp">-</div>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="d-block text-secondary small fw-bold mb-1">운영 모드</label>
                                            <div class="fs-6 text-dark bg-light p-2 rounded" id="view_op_mode">-</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="d-block text-secondary small fw-bold mb-1">공급자</label>
                                            <div class="fs-6 text-dark bg-light p-2 rounded" id="view_supplier">-</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="d-block text-secondary small fw-bold mb-1">데이터센터 (위치)</label>
                                            <div class="fs-6 text-dark bg-light p-2 rounded" id="view_idc">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row g-4 mb-4">
                                <div class="col-lg-6">
                                    <div class="card border shadow-sm h-100">
                                        <div class="card-header bg-white border-bottom-0 pt-3 pb-2">
                                            <h6 class="fw-bold text-primary mb-0"><i class="bi bi-archive me-2"></i>컨피그
                                                백업</h6>
                                        </div>
                                        <div class="card-body pt-0">
                                            <hr class="mt-0 mb-3 text-secondary opacity-25">
                                            <div class="row g-3">
                                                <div class="col-6">
                                                    <label class="d-block text-secondary small fw-bold mb-1">백업
                                                        여부</label>
                                                    <div class="fs-6 text-dark bg-light p-2 rounded"
                                                         id="view_backup_yn">-
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <label class="d-block text-secondary small fw-bold mb-1">백업
                                                        주기</label>
                                                    <div class="fs-6 text-dark bg-light p-2 rounded"
                                                         id="view_backup_cycle">-
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <label class="d-block text-secondary small fw-bold mb-1">백업
                                                        특이사항</label>
                                                    <div class="fs-6 text-dark bg-light p-2 rounded"
                                                         id="view_backup_note">-
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="card border shadow-sm h-100">
                                        <div class="card-header bg-white border-bottom-0 pt-3 pb-2">
                                            <h6 class="fw-bold text-primary mb-0"><i
                                                    class="bi bi-calendar-event me-2"></i>날짜 정보
                                            </h6>
                                        </div>
                                        <div class="card-body pt-0">
                                            <hr class="mt-0 mb-3 text-secondary opacity-25">
                                            <div class="row g-3">
                                                <div class="col-6">
                                                    <label class="d-block text-secondary small fw-bold mb-1">설치일</label>
                                                    <div class="fs-6 text-dark bg-light p-2 rounded" id="view_install">
                                                        -
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <label class="d-block text-secondary small fw-bold mb-1">폐기일</label>
                                                    <div class="fs-6 text-secondary bg-light p-2 rounded"
                                                         id="view_disposal">-
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <label class="d-block text-secondary small fw-bold mb-1">라이선스
                                                        만료일</label>
                                                    <div class="fs-6 text-danger fw-bold bg-light p-2 rounded"
                                                         id="view_license">-
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card border shadow-sm mb-4">
                                <div class="card-header bg-white border-bottom-0 pt-3 pb-2">
                                    <h6 class="fw-bold text-primary mb-0"><i class="bi bi-journal-text me-2"></i>기타 정보
                                    </h6>
                                </div>
                                <div class="card-body pt-0">
                                    <hr class="mt-0 mb-3 text-secondary opacity-25">
                                    <div class="mb-3">
                                        <label class="d-block text-secondary small fw-bold mb-1">특이사항</label>
                                        <div class="bg-light p-2 rounded text-dark" id="view_ci_note"
                                             style="min-height: 40px; white-space: pre-line;">-
                                        </div>
                                    </div>
                                    <div>
                                        <label class="d-block text-secondary small fw-bold mb-1">비고</label>
                                        <div class="bg-light p-2 rounded text-dark" id="view_desc"
                                             style="min-height: 40px; white-space: pre-line;">-
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card border shadow-sm">
                                <div class="card-body py-3">
                                    <div class="row align-items-center">
                                        <div class="col-md-6 border-end">
                                            <div class="d-flex align-items-center">
                                                <div class="text-secondary small fw-bold me-3" style="width: 80px;">최초
                                                    등록자
                                                </div>
                                                <div class="d-flex align-items-center">
                                                    <i class="bi bi-person-fill text-muted me-1"></i>
                                                    <span class="text-dark fw-bold" id="view_submitter">-</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-center ps-md-3">
                                                <div class="text-secondary small fw-bold me-3" style="width: 80px;">마지막
                                                    수정
                                                </div>
                                                <div class="text-dark font-monospace" id="view_updated">-</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="modal-footer bg-white border-top-0 pt-0 pb-4 pe-4">
                            <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">닫기</button>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal fade" id="contractModal" tabindex="-1">
                <div class="modal-dialog">
                    <form id="contractForm" class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title fw-bold">계약 정보 등록</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" name="person_id" value="{{ people.Person_ID }}">

                            <div class="row g-3 mb-3">
                                <div class="col-6">
                                    <label class="form-label small fw-bold text-primary">서비스 유형</label>
                                    <select class="form-select" name="service_type">
                                        <option value="">-- 선택 --</option>
                                        <option value="BK">BK</option>
                                        <option value="BK(Only)">BK(Only)</option>
                                        <option value="CO">CO</option>
                                        <option value="CO_BA">CO_BA</option>
                                        <option value="CO_PRE">CO_PRE</option>
                                        <option value="SH_BA">SH_BA</option>
                                        <option value="SH_PRE">SH_PRE</option>
                                        <option value="기타">기타</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label class="form-label small fw-bold">서비스 번호 *</label>
                                    <input type="text" class="form-control" name="service_number"
                                           placeholder="예: C01002149"
                                           required>
                                </div>
                            </div>

                            <div class="row g-3 mb-3">
                                <div class="col-6">
                                    <label class="form-label small fw-bold">계약 상태</label>
                                    <select class="form-select" name="service_status">
                                        <option value="1">사용중</option>
                                        <option value="2">개통중</option>
                                        <option value="5">해지</option>
                                    </select>
                                </div>
                                <div class="col-6">
                                    <label class="form-label small fw-bold">계약 금액</label>
                                    <input type="text" class="form-control" name="contract_amount" placeholder="원 단위">
                                </div>
                            </div>

                            <div class="row g-3 mb-3">
                                <div class="col-6">
                                    <label class="form-label small fw-bold">개통일</label>
                                    <input type="date" class="form-control" name="open_date">
                                </div>
                                <div class="col-6">
                                    <label class="form-label small fw-bold">해지일</label>
                                    <input type="date" class="form-control" name="terminate_date">
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label small fw-bold">비고</label>
                                <textarea class="form-control" name="contract_note" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
                            <button type="button" class="btn btn-primary" onclick="saveContract()">저장</button>
                        </div>
                    </form>
                </div>
            </div>
            {% endblock %}
