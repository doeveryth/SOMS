{% extends "base.html" %}
{% block title %}고객 상세 · SOMS{% endblock %}

{% block content %}
<div class="py-4">
  <div class="container-fluid">
    <div class="row g-4">

      <div class="col-md-3">
        <div class="card border-0 shadow-sm sticky-top" style="top: 1rem;">
          <div class="card-body text-center p-4">
            <div class="mb-3">
              <div class="avatar-circle bg-light text-primary mx-auto mb-3 d-flex align-items-center justify-content-center"
                   style="width: 80px; height: 80px; border-radius: 50%;">
                <i class="fa-solid fa-building fa-2x"></i>
              </div>
            </div>

            <h4 class="fw-bold mb-1">{{ people.Company }}</h4>
            <div class="text-muted mb-3">{{ people.Last_Name or '-' }}</div>

            <div class="d-flex justify-content-center gap-2 mb-4">
              {% if people.Service_Status|string == '1' %}
                <span class="badge bg-success rounded-pill px-3 py-2 fs-6">사용중</span>
              {% elif people.Service_Status|string == '2' %}
                <span class="badge bg-info text-dark rounded-pill px-3 py-2 fs-6">개통중</span>
              {% elif people.Service_Status|string == '3' %}
                <span class="badge bg-danger rounded-pill px-3 py-2 fs-6">이용정지</span>
              {% elif people.Service_Status|string == '5' %}
                <span class="badge bg-secondary rounded-pill px-3 py-2 fs-6">해지</span>
              {% else %}
                <span class="badge bg-secondary rounded-pill px-3 py-2 fs-6">{{ people.Service_Status or '-' }}</span>
              {% endif %}

              {% if people.Client_Sensitivity|string == '0' %}
                <span class="badge bg-danger rounded-pill px-3 py-2 fs-6">민감</span>
              {% elif people.Client_Sensitivity|string == '2' %}
                <span class="badge bg-warning text-dark rounded-pill px-3 py-2 fs-6">VIP</span>
              {% else %}
                <span class="badge bg-light text-dark border rounded-pill px-3 py-2 fs-6">표준</span>
              {% endif %}
            </div>

            <hr class="my-4 dashed">

            <div class="text-start px-2">
                <div class="mb-3">
                    <label class="text-secondary fw-bold mb-1">영업 담당자</label>
                    <div class="fs-6">{{ people.Sales_Manager or '미지정' }}</div>
                </div>
            </div>

            <div class="d-grid gap-2 mt-4">
              <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#customerEditModal">
                <i class="bi bi-pencil-square me-1"></i> 정보 수정
              </button>
              <a class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#workCreateModal">
                <i class="bi bi-journal-plus me-1"></i> 작업 추가
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-9">
        <ul class="nav nav-tabs mb-3" style="font-size: 1.1rem;">
          <li class="nav-item"><button class="nav-link active fw-bold" data-bs-toggle="tab" data-bs-target="#tab-overview">대시보드</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-assets">보안장비</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-servers">서버</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-contacts">담당자</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-work">작업 이력</button></li>
          <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-admin">계약 및 관리</button></li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane fade show active" id="tab-overview">

            <div class="row g-4">

              <div class="col-md-6">
                <div class="card h-100 shadow-sm border-0">
                  <div class="card-header bg-white py-3 border-bottom-0">
                    <h5 class="card-title mb-0 fw-bold"><i class="bi bi-info-circle text-primary me-2"></i>서비스 및 계약</h5>
                  </div>
                  <div class="card-body pt-0">
                    <table class="table table-borderless mb-0 align-middle">
                      <tbody>
                        <tr>
                          <th class="text-secondary fw-bold" style="width: 140px;">서비스 번호</th>
                          <td class="fs-6 fw-bold text-dark">{{ people.Service_Number or '-' }}</td>
                        </tr>
                        <tr>
                          <th class="text-secondary fw-bold">서비스 유형</th>
                          <td class="fs-6">{{ people.Service_Type or '-' }}</td>
                        </tr>
                        <tr>
                          <th class="text-secondary fw-bold">업종 분류</th>
                          <td class="fs-6">{{ people.Business_Type or '-' }} <span class="text-muted">/</span> {{ people.Business_Detail or '-' }}</td>
                        </tr>
                        <tr>
                          <th class="text-secondary fw-bold">정기 레포트</th>
                          <td class="fs-6">
                            {% if people.Report_YN == '0' or people.Report_YN == 'Y' %}
                              <span class="text-success fw-bold"><i class="bi bi-check-circle-fill me-1"></i>발송함</span>
                            {% else %}
                              <span class="text-muted">미발송</span>
                            {% endif %}
                          </td>
                        </tr>
                        <tr><td colspan="2"><hr class="my-2 text-muted opacity-25"></td></tr>
                        <tr>
                          <th class="text-secondary fw-bold">개통일</th>
                          <td class="fs-6">{{ people.Open_Date or '-' }}</td>
                        </tr>
                        <tr>
                          <th class="text-secondary fw-bold">해지일</th>
                          <td class="fs-6 {{ 'text-danger fw-bold' if people.Terminate_Date else '' }}">{{ people.Terminate_Date or '-' }}</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="card h-100 shadow-sm border-0">
                  <div class="card-header bg-white py-3 border-bottom-0">
                    <h5 class="card-title mb-0 fw-bold"><i class="bi bi-geo-alt text-primary me-2"></i>위치 및 접속</h5>
                  </div>
                  <div class="card-body pt-0">
                    <table class="table table-borderless mb-0 align-middle">
                      <tbody>
                        <tr>
                          <th class="text-secondary fw-bold" style="width: 140px;">DC(데이터센터)</th>
                          <td class="fs-6 fw-bold">{{ people.IDC or '-' }}</td>
                        </tr>
                        <tr>
                          <th class="text-secondary fw-bold">Rack 위치</th>
                          <td class="fs-6">{{ people.Rack_Location or '-' }}</td>
                        </tr>
                        <tr><td colspan="2"><hr class="my-2 text-muted opacity-25"></td></tr>

                        <tr>
                          <th class="text-secondary fw-bold">고객 폴더</th>
                          <td>
                            {% if people.Customer_Folder %}
                              <div class="p-2 bg-light rounded text-break border fs-6">
                                <a href="{{ people.Customer_Folder }}" target="_blank" class="text-decoration-none text-dark">{{ people.Customer_Folder }}</a>
                              </div>
                            {% else %}
                              -
                            {% endif %}
                          </td>
                        </tr>

                        <tr>
                          <th class="text-secondary fw-bold">서비스 URL</th>
                          <td>
                            {% if people.Service_URL__c %}
                              <div class="p-2 bg-light rounded text-break border fs-6" style="white-space: pre-wrap;">{{ people.Service_URL__c }}</div>
                            {% else %}
                              -
                            {% endif %}
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="col-12">
                <div class="card shadow-sm border-0">
                  <div class="card-header bg-white py-3 border-bottom-0">
                    <h5 class="card-title mb-0 fw-bold"><i class="bi bi-hdd-network text-primary me-2"></i>부가 서비스 구성</h5>
                  </div>
                  <div class="card-body pt-0">
                    <div class="table-responsive">
                      <table class="table table-bordered align-middle mb-0">
                        <thead class="table-light text-center">
                          <tr>
                            <th style="width: 15%;" class="fs-6">구분</th>
                            <th style="width: 20%;" class="fs-6">항목</th>
                            <th class="fs-6">상세 내용</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td rowspan="4" class="text-center bg-light fw-bold text-secondary fs-6">백업</td>
                            <td class="text-center fw-bold text-secondary fs-6">사용 여부</td>
                            <td class="fs-6">
                                {% if people.Backup_Service == 'y' %}
                                    <span class="text-primary fw-bold">사용함</span>
                                {% else %}
                                    <span class="text-muted">미사용</span>
                                {% endif %}
                            </td>
                          </tr>
                          <tr>
                            <td class="text-center fw-bold text-secondary fs-6">유형</td>
                            <td class="fs-6">
                               {% if people.Backup_Type|string == '0' %} 원격(전체)
                               {% elif people.Backup_Type|string == '1' %} 원격(DB)
                               {% elif people.Backup_Type|string == '2' %} 원격(File)
                               {% elif people.Backup_Type|string == '3' %} 로컬(전체)
                               {% elif people.Backup_Type|string == '4' %} 로컬(DB)
                               {% elif people.Backup_Type|string == '5' %} 로컬(File)
                               {% elif people.Backup_Type|string == '6' %} 소산
                               {% elif people.Backup_Type|string == '7' %} 원격+소산
                               {% elif people.Backup_Type|string == '8' %} 로컬+소산
                               {% else %} {{ people.Backup_Type or '-' }} {% endif %}
                            </td>
                          </tr>
                          <tr>
                            <td class="text-center fw-bold text-secondary fs-6">주기/용량</td>
                            <td class="fs-6">{{ people.Backup_Period or '-' }}</td>
                          </tr>
                          <tr>
                            <td class="text-center fw-bold text-secondary fs-6">백업 경로</td>
                            <td class="font-monospace fs-6 text-dark">{{ people.Backup_Path or '-' }}</td>
                          </tr>

                          <tr>
                            <td rowspan="2" class="text-center bg-light fw-bold text-secondary fs-6">보안</td>
                            <td class="text-center fw-bold text-secondary fs-6">백신</td>
                            <td class="fs-6 fw-bold">{{ people.Vaccine__c or '미설치' }}</td>
                          </tr>
                          <tr>
                            <td class="text-center fw-bold text-secondary fs-6">쉘 모니터링</td>
                            <td class="fs-6 fw-bold">{{ people.ShellMonitor__c or '미설치' }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-12">
                <div class="row g-4">
                  <div class="col-md-6">
                    <div class="card shadow-sm border-0 h-100">
                      <div class="card-header bg-white py-3 border-bottom-0 d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0 fw-bold text-danger"><i class="bi bi-exclamation-circle me-2"></i>고객 특이사항</h5>
                        <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#noteModalEtc">
                          전체 보기
                        </button>
                      </div>
                      <div class="card-body pt-0">
                        <div class="p-3 bg-light rounded border text-secondary" style="min-height: 100px; max-height: 100px; overflow: hidden; position: relative;">
                           {{ people.chEtc or '등록된 특이사항이 없습니다.' }}
                           <div style="position: absolute; bottom: 0; left: 0; width: 100%; height: 40px; background: linear-gradient(transparent, #f8f9fa);"></div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="card shadow-sm border-0 h-100">
                      <div class="card-header bg-white py-3 border-bottom-0 d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0 fw-bold text-warning"><i class="bi bi-shield-exclamation me-2"></i>침해 대응 이력</h5>
                        <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#noteModalHistory">
                          전체 보기
                        </button>
                      </div>
                      <div class="card-body pt-0">
                        <div class="p-3 bg-light rounded border text-secondary" style="min-height: 100px; max-height: 100px; overflow: hidden; position: relative;">
                           {{ people.chHistory or '등록된 이력이 없습니다.' }}
                           <div style="position: absolute; bottom: 0; left: 0; width: 100%; height: 40px; background: linear-gradient(transparent, #f8f9fa);"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div> </div>
          <!-- Assets Tab -->
          <div class="tab-pane fade" id="tab-assets">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="mb-0">보안장비</h6>
              <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#assetAddModal">
                <i class="fa-solid fa-plus"></i> 장비 추가
              </button>
            </div>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="table-light">
                  <tr>
                    <th>장비명</th>
                    <th>유형</th>
                    <th>제조사</th>
                    <th>모델</th>
                    <th>상태</th>
                    <th>설치일</th>
                    <th style="width: 120px;"></th>
                  </tr>
                </thead>
                <tbody>
                  {% for c in ci_rows %}
                  <tr>
                    <td>{{ c.Name }}</td>
                    <td>{{ c.Type }}</td>
                    <td>{{ c.Manufacturer_Name }}</td>
                    <td>{{ c.Model_Number }}</td>
                    <td>
                      {% if c.AssetLifecycleStatus == 3 %}
                      <span class="badge bg-success">사용중</span>
                      {% elif c.AssetLifecycleStatus == 1 %}
                      <span class="badge bg-info">입고됨</span>
                      {% elif c.AssetLifecycleStatus == 0 %}
                      <span class="badge bg-secondary">주문됨</span>
                      {% elif c.AssetLifecycleStatus == 11 %}
                      <span class="badge bg-danger">해지/폐기</span>
                      {% else %}
                      <span class="badge bg-secondary">{{ c.AssetLifecycleStatus }}</span>
                      {% endif %}
                    </td>
                    <td>{{ c.InstallationDate.strftime('%Y-%m-%d') if c.InstallationDate else '-' }}</td>
                    <td class="text-end">
                      <button type="button" class="btn btn-sm btn-outline-primary"
                              onclick="editAsset({{ c.Asset_ID }}, {{ people.Person_ID }})">수정</button>
                      <form method="post" action="{{ url_for('customers.delete_ci', person_id=people.Person_ID, asset_id=c.Asset_ID) }}"
                            onsubmit="return confirm('보안장비를 삭제할까요?');" style="display: inline;">
                        <button class="btn btn-sm btn-outline-danger" type="submit">삭제</button>
                      </form>
                    </td>
                  </tr>
                  {% else %}
                  <tr>
                    <td colspan="7" class="text-center text-muted">등록된 보안장비가 없습니다.</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>

          <!-- Servers Tab -->
          <div class="tab-pane fade" id="tab-servers">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="mb-0">서버</h6>
              <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#serverAddModal">
                <i class="fa-solid fa-plus"></i> 서버 추가
              </button>
            </div>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="table-light">
                  <tr>
                    <th>서버명</th>
                    <th>정보</th>
                    <th>등록자</th>
                    <th style="width: 120px;"></th>
                  </tr>
                </thead>
                <tbody>
                  {% for s in server_rows %}
                  <tr>
                    <td>{{ s.chServerName }}</td>
                    <td>{{ s.chServerInfo }}</td>
                    <td>{{ s.Submitter }}</td>
                    <td class="text-end">
                      <button type="button" class="btn btn-sm btn-outline-primary"
                              onclick="editServer({{ s.Server_ID }}, {{ people.Person_ID }})">수정</button>
                      <form method="post" action="{{ url_for('customers.delete_server', person_id=people.Person_ID, server_id=s.Server_ID) }}"
                            onsubmit="return confirm('서버를 삭제할까요?');" style="display: inline;">
                        <button class="btn btn-sm btn-outline-danger" type="submit">삭제</button>
                      </form>
                    </td>
                  </tr>
                  {% else %}
                  <tr>
                    <td colspan="4" class="text-center text-muted">데이터 없음</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>

          <!-- Contacts Tab -->
          <div class="tab-pane fade" id="tab-contacts">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="mb-0">담당자</h6>
              <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#contactAddModal">
                <i class="fa-solid fa-plus"></i> 담당자 추가
              </button>
            </div>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="table-light">
                  <tr>
                    <th>이름</th>
                    <th>역할</th>
                    <th>전화</th>
                    <th>이메일</th>
                    <th style="width: 120px;"></th>
                  </tr>
                </thead>
                <tbody>
                  {% for c in contact_rows %}
                  <tr>
                    <td>{{ c.Name }}</td>
                    <td>{{ c.Role_Type }}</td>
                    <td>{{ c.Phone }}</td>
                    <td>{{ c.Email }}</td>
                    <td class="text-end">
                      <button type="button" class="btn btn-sm btn-outline-primary"
                              onclick="editContact({{ c.Contact_ID }}, {{ people.Person_ID }})">수정</button>
                      <form method="post" action="{{ url_for('customers.delete_contact', person_id=people.Person_ID, contact_id=c.Contact_ID) }}"
                            onsubmit="return confirm('담당자를 삭제할까요?');" style="display: inline;">
                        <button class="btn btn-sm btn-outline-danger" type="submit">삭제</button>
                      </form>
                    </td>
                  </tr>
                  {% else %}
                  <tr>
                    <td colspan="5" class="text-center text-muted">데이터 없음</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>

          <!-- Work Log Tab -->
          <div class="tab-pane fade" id="tab-work">
            <div class="mb-3">
              <div class="d-flex gap-2 mb-3">
                <input type="text" class="form-control" id="workFilterText" placeholder="검색...">
                <input type="date" class="form-control" id="workFilterFrom" style="max-width: 150px;">
                <input type="date" class="form-control" id="workFilterTo" style="max-width: 150px;">
              </div>
            </div>
            <div class="table-responsive">
              <table class="table table-hover" id="workTable">
                <thead class="table-light">
                  <tr>
                    <th>작업일</th>
                    <th>유형</th>
                    <th>요약</th>
                    <th>등록자</th>
                    <th>등록일</th>
                  </tr>
                </thead>
                <tbody>
                  {% for w in work_rows %}
                  <tr class="work-row" data-work-id="{{ w.Work_ID }}"
                      data-company="{{ people.Company }}"
                      data-last-name="{{ people.Last_Name or '' }}"
                      data-work-date="{{ w.Work_Date or '' }}"
                      data-type="{{ w.Work_Type or '' }}"
                      data-summary="{{ w.Summary or '' }}"
                      data-description="{{ w.Description or '' }}"
                      data-submitter="{{ w.Submitter or '' }}"
                      data-create-date="{{ w.Create_Date.strftime('%Y-%m-%d') if w.Create_Date else '' }}"
                      data-history="{{ people.chHistory or '' }}"
                      data-etc="{{ people.chEtc or '' }}">
                    <td>{{ w.Work_Date or '-' }}</td>
                    <td><span class="badge bg-secondary">{{ w.Work_Type }}</span></td>
                    <td>{{ w.Summary or (w.Description[:50] if w.Description else '-') }}</td>
                    <td>{{ w.Submitter }}</td>
                    <td>{{ w.Create_Date.strftime('%Y-%m-%d') if w.Create_Date else '-' }}</td>
                  </tr>
                  {% else %}
                  <tr>
                    <td colspan="5" class="text-center text-muted">작업 이력이 없습니다.</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>

          <!-- Admin Tab -->
          <div class="tab-pane fade" id="tab-admin">
            <h6 class="mb-3">계약 정보</h6>
            <div class="table-responsive">
              <table class="table table-hover table-striped">
                <thead class="table-light">
                  <tr>
                    <th>계약명</th>
                    <th>금액</th>
                    <th>기간</th>
                    <th style="width: 120px;"></th>
                  </tr>
                </thead>
                <tbody>
                  {% for c in contract_rows %}
                  <tr>
                    <td>{{ c.Contract_Name }}</td>
                    <td>{{ c.Contract_Amount }}</td>
                    <td>{{ c.Contract_Start_Date }} ~ {{ c.Contract_End_Date }}</td>
                    <td class="text-end">
                      <button type="button" class="btn btn-sm btn-outline-primary"
                              onclick="editContract({{ c.Contract_ID }}, {{ people.Person_ID }})">수정</button>
                      <form method="post" action="{{ url_for('customers.delete_contract', person_id=people.Person_ID, contract_id=c.Contract_ID) }}"
                            onsubmit="return confirm('계약을 삭제(숨김)할까요?');" style="display: inline;">
                        <button class="btn btn-sm btn-outline-danger" type="submit">삭제</button>
                      </form>
                    </td>
                  </tr>
                  {% else %}
                  <tr>
                    <td colspan="4" class="text-center text-muted">데이터 없음</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="customerEditModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">

    <form method="post" action="{{ url_for('customers.update_customer', person_id=people.Person_ID) }}">

      <div class="modal-content bg-light">

        <div class="modal-header bg-white border-bottom-0 shadow-sm py-3">
          <h5 class="modal-title fw-bold text-primary">
            <i class="bi bi-pencil-square me-2"></i>고객 정보 수정
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
        </div>

        <div class="modal-body p-4" style="max-height: 70vh; overflow-y: auto;">

          <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white border-bottom fw-bold text-dark">
              <i class="bi bi-person-badge me-1"></i> 기본 정보 및 설정
            </div>
            <div class="card-body">
              <div class="row g-3">

                <div class="col-md-4">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="company" name="company" value="{{ people.Company or '' }}" placeholder="고객명">
                    <label for="company" class="fw-bold text-primary">고객명 (Company)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="last_name" name="last_name" value="{{ people.Last_Name or '' }}" placeholder="사이트명">
                    <label for="last_name" class="fw-bold text-primary">사이트명 (Site Name)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="service_type" name="service_type" value="{{ people.Service_Type or '' }}" placeholder="서비스유형">
                    <label for="service_type">서비스 유형</label>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="industry_category" name="industry_category" value="{{ people.Business_Type or '' }}" placeholder="업종 분류">
                    <label for="industry_category">고객 업종 분류</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="industry_detail" name="industry_detail" value="{{ people.Business_Detail or '' }}" placeholder="업종 세부">
                    <label for="industry_detail">고객 업종 세부</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <select class="form-select" id="profile_status" name="profile_status">
                      <option value="0" {% if people.Service_Status|string == '0' %}selected{% endif %}>-- 선택 --</option>
                      <option value="1" {% if people.Service_Status|string == '1' %}selected{% endif %}>사용중</option>
                      <option value="2" {% if people.Service_Status|string == '2' %}selected{% endif %}>개통중</option>
                      <option value="3" {% if people.Service_Status|string == '3' %}selected{% endif %}>이용정지</option>
                      <option value="4" {% if people.Service_Status|string == '4' %}selected{% endif %}>일시이용중단</option>
                      <option value="5" {% if people.Service_Status|string == '5' %}selected{% endif %}>해지</option>
                    </select>
                    <label for="profile_status">현재 상태</label>
                  </div>
                </div>

                <div class="col-md-6">
                    <div class="form-floating">
                        <select class="form-select" id="client_sensitivity" name="client_sensitivity">
                            <option value="1" {% if people.Client_Sensitivity|string == '1' %}selected{% endif %}>표준</option>
                            <option value="0" {% if people.Client_Sensitivity|string == '0' %}selected{% endif %}>민감</option>
                            <option value="2" {% if people.Client_Sensitivity|string == '2' %}selected{% endif %}>VIP</option>
                        </select>
                        <label for="client_sensitivity">고객 민감도</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <select class="form-select" id="report_yn" name="report_yn">
                            <option value="0" {% if people.Report_YN|string == '0' %}selected{% endif %}>Y</option>
                            <option value="1" {% if people.Report_YN|string == '1' %}selected{% endif %}>N</option>
                        </select>
                        <label for="report_yn">정기 레포트</label>
                    </div>
                </div>

                <div class="col-12">
                  <div class="form-floating">
                    <textarea class="form-control" name="service_url" placeholder="URL" style="height: 80px;">{{ people.Service_URL__c or '' }}</textarea>
                    <label>서비스 URL</label>
                  </div>
                </div>

                <div class="col-12">
                  <div class="form-floating">
                    <input type="text" class="form-control" name="customer_folder" value="{{ people.Customer_Folder or '' }}" placeholder="폴더 경로">
                    <label>고객 폴더 경로</label>
                  </div>
                </div>

              </div>
            </div>
          </div>

          <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white border-bottom fw-bold text-dark">
              <i class="bi bi-calendar-range me-1"></i> 계약 및 위치 정보
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-12">
                  <label class="form-label small text-muted mb-1">서비스 기간</label>
                  <div class="input-group">
                    <span class="input-group-text">개통</span>
                    <input type="date" class="form-control" name="open_date" value="{{ people.Open_Date or '' }}">
                    <span class="input-group-text">해지</span>
                    <input type="date" class="form-control" name="close_date" value="{{ people.Terminate_Date or '' }}">
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input type="text" class="form-control" name="dc_location" value="{{ people.IDC or '' }}" placeholder="DC명">
                    <label><i class="bi bi-building me-1"></i>DC (데이터센터)</label>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="form-floating">
                    <input type="text" class="form-control" name="rack_location" value="{{ people.Rack_Location or '' }}" placeholder="위치">
                    <label>Rack 위치</label>
                  </div>
                </div>

                <div class="col-12">
                    <div class="form-floating">
                         <input type="text" class="form-control" name="service_number" value="{{ people.Service_Number or '' }}" placeholder="번호">
                         <label class="text-primary fw-bold">서비스 번호</label>
                    </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white border-bottom fw-bold text-dark">
              <i class="bi bi-hdd-network me-1"></i> 부가 서비스
            </div>
            <div class="card-body">
              <div class="row g-3">

                <div class="col-12"><h6 class="text-muted small fw-bold mb-0">백업 구성</h6></div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <select class="form-select" name="backup_service_yn">
                      <option value="n" {% if people.Backup_Service == 'n' %}selected{% endif %}>미사용</option>
                      <option value="y" {% if people.Backup_Service == 'y' %}selected{% endif %}>사용함</option>
                    </select>
                    <label>백업 사용 여부</label>
                  </div>
                </div>
                <div class="col-md-5">
                  <div class="form-floating">
                    <select class="form-select" id="backup_type" name="backup_type">
                      <option value="">유형 선택</option>
                      <option value="0" {% if people.Backup_Type|string == '0' %}selected{% endif %}>원격 (전체)</option>
                      <option value="1" {% if people.Backup_Type|string == '1' %}selected{% endif %}>원격 (DB)</option>
                      <option value="2" {% if people.Backup_Type|string == '2' %}selected{% endif %}>원격 (File)</option>
                      <option value="3" {% if people.Backup_Type|string == '3' %}selected{% endif %}>로컬 (전체)</option>
                      <option value="4" {% if people.Backup_Type|string == '4' %}selected{% endif %}>로컬 (DB)</option>
                      <option value="5" {% if people.Backup_Type|string == '5' %}selected{% endif %}>로컬 (File)</option>
                      <option value="6" {% if people.Backup_Type|string == '6' %}selected{% endif %}>소산 백업</option>
                      <option value="7" {% if people.Backup_Type|string == '7' %}selected{% endif %}>원격 + 소산</option>
                      <option value="8" {% if people.Backup_Type|string == '8' %}selected{% endif %}>로컬 + 소산</option>
                    </select>
                    <label for="backup_type">백업 유형</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input type="text" class="form-control" name="backup_period_volume" value="{{ people.Backup_Period or '' }}" placeholder="예: Daily / 500GB">
                    <label>주기 및 용량</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <input type="text" class="form-control" name="backup_path" value="{{ people.Backup_Path or '' }}" placeholder="경로">
                    <label>백업 경로 (Backup Path)</label>
                  </div>
                </div>

                <div class="col-12 mt-4"><h6 class="text-muted small fw-bold mb-0">보안 솔루션 (종류 및 수량)</h6></div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="vaccine_yn" name="vaccine_yn" value="{{ people.Vaccine__c or '' }}" placeholder="종류/수량">
                    <label for="vaccine_yn">백신</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="shell_monitor_yn" name="shell_monitor_yn" value="{{ people.ShellMonitor__c or '' }}" placeholder="종류/수량">
                    <label for="shell_monitor_yn">쉘 모니터링</label>
                  </div>
                </div>

              </div>
            </div>
          </div>

          <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom fw-bold text-dark">
              <i class="bi bi-journal-text me-1"></i> 특이사항 및 메모
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <textarea class="form-control" id="customer_notes" name="customer_notes" style="height: 100px">{{ people.chEtc or '' }}</textarea>
                    <label for="customer_notes">고객 특이사항</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <textarea class="form-control" name="intrusion_notes" style="height: 80px">{{ people.chHistory or '' }}</textarea>
                    <label>침탐 특이사항</label>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="modal-footer bg-white shadow-sm border-top-0 py-3">
          <button type="button" class="btn btn-light" data-bs-dismiss="modal">취소</button>
          <button type="submit" class="btn btn-primary px-4 fw-bold">
            <i class="bi bi-save me-1"></i> 변경사항 저장
          </button>
        </div>

      </div>
    </form>
  </div>
</div>
<!-- 작업 등록 모달 -->
<div class="modal fade" id="workCreateModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <div>
          <div class="fw-bold">작업 등록</div>
          <div class="text-muted small">고객/작업유형/작업일 필수</div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <form id="workCreateForm">
        <div class="modal-body">
          <div class="text-danger small mb-2" id="workCreateError"></div>
          <input type="hidden" name="person_id" value="{{ people.Person_ID }}">
          <div class="row g-3">
            <div class="col-md-8">
              <label class="form-label">고객</label>
              <input class="form-control" value="{{ people.Company }}" disabled>
            </div>
            <div class="col-md-4">
              <label class="form-label">작업일 *</label>
              <input type="date" class="form-control" name="work_date" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">작업 정보 유형 *</label>
              <select class="form-select" name="work_type" required>
                <option value="">-- 선택 --</option>
                <option value="보안장비 변경">보안장비 변경</option>
                <option value="오더 정보">오더 정보</option>
                <option value="고객명 변경">고객명 변경</option>
                <option value="기타">기타</option>
                <option value="레포트">레포트</option>
                <option value="보안장비 이중화">보안장비 이중화</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">요약</label>
              <input class="form-control" name="summary">
            </div>
            <div class="col-12">
              <label class="form-label">상세정보</label>
              <textarea class="form-control" name="description" rows="6"></textarea>
            </div><div class="col-12">
              <label class="form-label">첨부파일</label>
              <input type="file" class="form-control" name="file">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">취소</button>
          <button type="submit" class="btn btn-primary">등록</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 작업 상세 모달 -->
<div class="modal fade" id="workDetailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <div class="fw-bold">작업 상세</div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-6">
            <div class="small text-muted">작업 ID</div>
            <div id="workDetailId">-</div>
          </div>
          <div class="col-md-6">
            <div class="small text-muted">작업일</div>
            <div id="workDetailDate">-</div>
          </div>
          <div class="col-md-6">
            <div class="small text-muted">회사</div>
            <div id="workDetailCompany">-</div>
          </div>
          <div class="col-md-6">
            <div class="small text-muted">사이트명</div>
            <div id="workDetailLastName">-</div>
          </div>
          <div class="col-md-6">
            <div class="small text-muted">유형</div>
            <div id="workDetailType">-</div>
          </div>
          <div class="col-md-6">
            <div class="small text-muted">등록자</div>
            <div id="workDetailSubmitter">-</div>
          </div>
          <div class="col-12">
            <div class="small text-muted">요약</div>
            <div id="workDetailSummary">-</div>
          </div>
          <div class="col-12">
            <div class="small text-muted">상세정보</div>
            <div id="workDetailContent" class="p-2 bg-light rounded">-</div>
          </div><div class="col-12">
            <div class="small text-muted">첨부파일</div>
            <div id="workDetailAttachments">-</div>
          </div>
          <div class="col-12">
            <div class="small text-muted">등록일</div>
            <div id="workDetailCreateDate">-</div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">닫기</button>
      </div>
    </div>
  </div>
</div>

<!-- 작업 수정 모달 -->
<div class="modal fade" id="workEditModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <div class="fw-bold">작업 수정</div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <form id="workEditForm">
        <div class="modal-body">
          <div class="text-danger small mb-2" id="workEditError"></div>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">담당자</label>
              <input type="text" class="form-control" name="person_id">
            </div>
            <div class="col-md-4">
              <label class="form-label">작업일 *</label>
              <input type="date" class="form-control" name="work_date" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">유형 *</label>
              <input type="text" class="form-control" name="work_type" required>
            </div>
            <div class="col-12">
              <label class="form-label">요약</label>
              <input type="text" class="form-control" name="summary">
            </div>
            <div class="col-12">
              <label class="form-label">상세정보</label>
              <textarea class="form-control" name="description" rows="4"></textarea>
            </div></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">취소</button>
          <button type="submit" class="btn btn-primary">저장</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 작업 삭제 모달 -->
<div class="modal fade" id="workDeleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <div class="fw-bold">작업 삭제</div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <form id="workDeleteForm">
        <div class="modal-body">
          <div class="text-danger small mb-2" id="workDeleteError"></div>
          <p class="mb-0">다음 작업을 삭제하시겠습니까? <strong id="workDeleteLabel">-</strong></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">취소</button>
          <button type="submit" class="btn btn-danger">삭제</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 보안장비 추가 모달 -->
<div class="modal fade" id="assetAddModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">보안장비 추가</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <form method="POST" action="{{ url_for('customers.add_asset', person_id=people.Person_ID) }}">
        <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
          <!-- 안내 문구 -->
          <div class="alert alert-info small mb-3">
            <i class="fa-solid fa-info-circle"></i>
            필수 항목(*)만 입력하면 등록됩니다. 나머지는 나중에 수정할 수 있습니다.
          </div>

          <!-- 기본 정보 (읽기 전용) -->
          <h6 class="border-bottom pb-2 mb-3">기본 정보</h6>
          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label">고객명 (회사명)</label>
              <input type="text" class="form-control" value="{{ people.Company }}" readonly>
            </div>
            <div class="col-md-6">
              <label class="form-label">사이트명</label>
              <input type="text" class="form-control" value="{{ people.Last_Name or people.Company }}" readonly>
            </div>
          </div>

          <!-- 장비 정보 입력 -->
          <h6 class="border-bottom pb-2 mb-3">
            <span class="text-danger">*</span> 장비 정보
          </h6>
          <div class="row g-3 mb-3">
            <div class="col-md-3">
              <label for="ci_name" class="form-label">CI 이름(장비 이름)</label>
              <input type="text" class="form-control" id="ci_name" name="ci_name">
            </div>
            <div class="col-md-3">
              <label for="category" class="form-label">
                <span class="text-danger">*</span> 계층 1
              </label>
              <select class="form-select" id="category" name="category" required>
                <option value="">-- 선택 --</option>
                <option value="보안장비">보안장비</option>
                <option value="보안장비_VIP">보안장비_VIP</option>
              </select>
            </div>
            <div class="col-md-3">
              <label for="type" class="form-label">
                <span class="text-danger">*</span> 계층 2
              </label>
              <select class="form-select" id="type" name="type" required>
                <option value="">-- 선택 --</option>
                <option value="방화벽">방화벽</option>
                <option value="방화벽_VIP">방화벽_VIP</option>
                <option value="NGFW">NGFW</option>
                <option value="웹방화벽">웹방화벽</option>
                <option value="스위치">스위치</option>
                <option value="UTM">UTM</option>
                <option value="UTM_VIP">UTM_VIP</option>
                <option value="IPS">IPS</option>
                <option value="IDS">IDS</option>
                <option value="DDoS">DDoS</option>
                <option value="VPN">VPN</option>
                <option value="라우터">라우터</option>
                <option value="스팸스나이퍼">스팸스나이퍼</option>
                <option value="스팸스나이퍼_VIP">스팸스나이퍼_VIP</option>
                <option value="웹키퍼">웹키퍼</option>
                <option value="로그서버">로그서버</option>
                <option value="암호화솔루션">암호화솔루션</option>
                <option value="기타">기타</option>
              </select>
            </div>
            <div class="col-md-3">
              <label for="item" class="form-label">계층 3</label>
              <select class="form-select" id="item" name="item">
                <option value="">-- 선택 (선택사항) --</option>
                <option value="Ahnlab">Ahnlab</option>
                <option value="AIWAF">AIWAF</option>
                <option value="AxGate">AxGate</option>
                <option value="Catalyst">Catalyst</option>
                <option value="Cisco">Cisco</option>
                <option value="EX">EX</option>
                <option value="F5">F5</option>
                <option value="FortiDDoS">FortiDDoS</option>
                <option value="Fortinet">Fortinet</option>
                <option value="FTG">FTG</option>
                <option value="FutureSystems">FutureSystems</option>
                <option value="HansolNexG">HansolNexG</option>
                <option value="HP">HP</option>
                <option value="ICTIS">ICTIS</option>
                <option value="ISG">ISG</option>
                <option value="iwall">iwall</option>
                <option value="Juniper">Juniper</option>
                <option value="L4">L4</option>
                <option value="L4 Alteon 180E">L4 Alteon 180E</option>
                <option value="L4 PumPkin">L4 PumPkin</option>
                <option value="MF2">MF2</option>
                <option value="MFI">MFI</option>
                <option value="Monitorapp">Monitorapp</option>
                <option value="NE">NE</option>
                <option value="Paloalto">Paloalto</option>
                <option value="Penta">Penta</option>
                <option value="Piolink">Piolink</option>
                <option value="PulseSecure">PulseSecure</option>
                <option value="RUCKUS">RUCKUS</option>
                <option value="Secui">Secui</option>
                <option value="SG2024">SG2024</option>
                <option value="Sniper">Sniper</option>
                <option value="SRX">SRX</option>
                <option value="SSG">SSG</option>
                <option value="TG">TG</option>
                <option value="TrendMicro">TrendMicro</option>
                <option value="UTM_VIP">UTM_VIP</option>
                <option value="VIP">VIP</option>
                <option value="Wapples">Wapples</option>
                <option value="Web Front">Web Front</option>
                <option value="Wins">Wins</option>
                <option value="XIOS">XIOS</option>
                <option value="로그서버">로그서버</option>
                <option value="방화벽_VIP">방화벽_VIP</option>
                <option value="스팸스나이퍼">스팸스나이퍼</option>
                <option value="스팸스나이퍼_VIP">스팸스나이퍼_VIP</option>
                <option value="웹키퍼">웹키퍼</option>
              </select>
            </div></div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label for="product_name" class="form-label">제품명</label>
              <input type="text" class="form-control" id="product_name" name="product_name" placeholder="예: iwall-2000, SSG-500">
            </div>
            <div class="col-md-6">
              <label for="model_number" class="form-label">버전/모델</label>
              <input type="text" class="form-control" id="model_number" name="model_number" placeholder="예: v7.2.4">
            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label for="manufacturer_name" class="form-label">제조사</label>
              <input type="text" class="form-control" id="manufacturer_name" name="manufacturer_name" placeholder="예: ICTIS, Cisco, Fortinet">
            </div>
            <div class="col-md-6">
              <label for="supplier" class="form-label">
                <span class="text-danger">*</span> 공급자명
              </label>
              <select class="form-select" id="supplier" name="supplier" required>
                <option value="">-- 선택 --</option>
                <option value="ICTIS">ICTIS</option>
                <option value="고객소유">고객소유</option>
                <option value="기타">기타</option>
                <option value="임대">임대</option>
                <option value="펜타시큐리티">펜타시큐리티</option>
              </select>
            </div>
          </div>

          <!-- 추가 정보 아코디언 -->
          <div class="accordion mb-3" id="additionalInfoAccordion">
            <!-- 장비 식별 정보 -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseIdentity">
                  장비 식별 정보
                </button>
              </h2>
              <div id="collapseIdentity" class="accordion-collapse collapse" data-bs-parent="#additionalInfoAccordion">
                <div class="accordion-body">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="serial_number" class="form-label">일련 번호 (S/N)</label>
                      <input type="text" class="form-control" id="serial_number" name="serial_number">
                    </div>
                    <div class="col-md-6">
                      <label for="ip_info" class="form-label">IP 정보</label>
                      <input type="text" class="form-control" id="ip_info" name="ip_info">
                    </div><div class="col-12">
                      <label for="ci_note" class="form-label">장비 특이사항</label>
                      <textarea class="form-control" id="ci_note" name="ci_note" rows="2" placeholder="장비 관련 특이사항을 입력하세요"></textarea>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 운영 정보 -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOperation">
                  운영 정보
                </button>
              </h2>
              <div id="collapseOperation" class="accordion-collapse collapse" data-bs-parent="#additionalInfoAccordion">
                <div class="accordion-body">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="maintenance_company" class="form-label">유지보수업체</label>
                      <select class="form-select" id="maintenance_company" name="maintenance_company">
                        <option value="12">없음</option>
                        <option value="0">ICTIS</option>
                        <option value="1">에스에이정보기술</option>
                        <option value="2">블루시큐어</option>
                        <option value="3">유콘텍</option>
                        <option value="4">유니포인트</option>
                        <option value="5">엔큐리티</option>
                        <option value="6">시큐트러스트</option>
                        <option value="7">모니터랩</option>
                        <option value="8">인스테크</option>
                        <option value="9">쿼리시스템즈</option>
                        <option value="10">에스디씨디엠</option>
                        <option value="11" selected>고객사 유지보수</option>
                        <option value="13">윈스</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="operation_company" class="form-label">운영업체</label>
                      <select class="form-select" id="operation_company" name="operation_company">
                        <option value="0" selected>ICTIS</option>
                        <option value="1">고객사</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="operation_mode" class="form-label">운영모드</label>
                      <select class="form-select" id="operation_mode" name="operation_mode">
                        <option value="0" selected>해당 없음</option>
                        <option value="1">탐지</option>
                        <option value="2">차단</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="idc_site" class="form-label">DC (데이터센터)</label>
                      <input type="text" class="form-control" id="idc_site" name="idc_site" value="{{ people.IDC or '' }}">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 백업 설정 -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBackup">
                  컨피그 백업 설정
                </button>
              </h2>
              <div id="collapseBackup" class="accordion-collapse collapse" data-bs-parent="#additionalInfoAccordion">
                <div class="accordion-body">
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label for="c_backup" class="form-label">컨피그 백업</label>
                      <select class="form-select" id="c_backup" name="c_backup">
                        <option value="0" selected>YES</option>
                        <option value="1">NO</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label for="c_cycle" class="form-label">백업 주기</label>
                      <select class="form-select" id="c_cycle" name="c_cycle">
                        <option value="0">Daily</option>
                        <option value="1">Weekly</option>
                        <option value="2" selected>Monthly</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label for="cfg_note" class="form-label">특이사항</label>
                      <input type="text" class="form-control" id="cfg_note" name="cfg_note">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 날짜 및 상태 -->
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseStatus">
                  상태 및 날짜 정보
                </button>
              </h2>
              <div id="collapseStatus" class="accordion-collapse collapse" data-bs-parent="#additionalInfoAccordion">
                <div class="accordion-body">
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="lifecycle_status" class="form-label">상태</label>
                      <select class="form-select" id="lifecycle_status" name="lifecycle_status">
                        <option value="3" selected>사용중(배치됨)</option>
                        <option value="0">주문됨</option>
                        <option value="1">입고됨</option>
                        <option value="9">회수(재고)</option>
                        <option value="11">해지(폐기됨)</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="installation_date" class="form-label">설치일</label>
                      <input type="date" class="form-control" id="installation_date" name="installation_date">
                    </div>
                    <div class="col-md-6">
                      <label for="license_expiry" class="form-label">라이선스 만료일</label>
                      <input type="date" class="form-control" id="license_expiry" name="license_expiry">
                    </div>
                    <div class="col-md-6">
                      <label for="disposal_date" class="form-label">폐기일</label>
                      <input type="date" class="form-control" id="disposal_date" name="disposal_date">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 비고 -->
          <div>
            <label for="description" class="form-label">비고</label>
            <textarea class="form-control" id="description" name="description" rows="2" placeholder="추가 정보나 특이사항을 입력하세요"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button type="submit" class="btn btn-primary">
            <i class="fa-solid fa-check"></i> 등록
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 보안장비 수정 모달 -->
<div class="modal fade" id="assetEditModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">보안장비 수정</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <form id="assetEditForm" method="POST">
        <div class="modal-body" id="assetEditBody">
          <!-- 동적으로 생성됨 -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button type="submit" class="btn btn-primary">저장</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 서버 추가 모달 -->
<div class="modal fade" id="serverAddModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">서버 추가</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <form method="POST" action="{{ url_for('customers.add_server', person_id=people.Person_ID) }}">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label">서버명 *</label>
              <input type="text" class="form-control" name="chServerName" required>
            </div>
            <div class="col-12">
              <label class="form-label">서버정보</label>
              <textarea class="form-control" name="chServerInfo" rows="3"></textarea>
            </div></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button type="submit" class="btn btn-primary">등록</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 서버 수정 모달 -->
<div class="modal fade" id="serverEditModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">서버 수정</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <form id="serverEditForm" method="POST">
        <div class="modal-body" id="serverEditBody">
          <!-- 동적으로 생성됨 -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button type="submit" class="btn btn-primary">저장</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 담당자 추가 모달 -->
<div class="modal fade" id="contactAddModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">담당자 추가</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <form method="POST" action="{{ url_for('customers.add_contact', person_id=people.Person_ID) }}">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">역할 *</label>
              <input type="text" class="form-control" name="role_type" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">이름 *</label>
              <input type="text" class="form-control" name="name" required>
            </div><div class="col-md-6">
              <label class="form-label">전화</label>
              <input type="tel" class="form-control" name="phone">
            </div>
            <div class="col-md-6">
              <label class="form-label">이메일</label>
              <input type="email" class="form-control" name="email">
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button type="submit" class="btn btn-primary">등록</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 담당자 수정 모달 -->
<div class="modal fade" id="contactEditModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">담당자 수정</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <form id="contactEditForm" method="POST">
        <div class="modal-body" id="contactEditBody">
          <!-- 동적으로 생성됨 -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button type="submit" class="btn btn-primary">저장</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 계약 추가 모달 -->
<div class="modal fade" id="contractAddModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">계약 추가</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <form method="POST" action="{{ url_for('customers.add_contract', person_id=people.Person_ID) }}">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label">계약명 *</label>
              <input type="text" class="form-control" name="contract_name" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">금액</label>
              <input type="text" class="form-control" name="contract_amount">
            </div>
            <div class="col-md-6">
              <label class="form-label">통화</label>
              <input type="text" class="form-control" name="currency" value="KRW">
            </div>
            <div class="col-md-6">
              <label class="form-label">계약시작일</label>
              <input type="date" class="form-control" name="contract_start_date">
            </div>
            <div class="col-md-6">
              <label class="form-label">계약종료일</label>
              <input type="date" class="form-control" name="contract_end_date">
            </div><div class="col-12">
              <label class="form-label">비고</label>
              <textarea class="form-control" name="contract_notes" rows="3"></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button type="submit" class="btn btn-primary">등록</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 계약 수정 모달 -->
<div class="modal fade" id="contractEditModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">계약 수정</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="닫기"></button>
      </div>
      <form id="contractEditForm" method="POST">
        <div class="modal-body" id="contractEditBody">
          <!-- 동적으로 생성됨 -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
          <button type="submit" class="btn btn-primary">저장</button>
        </div>
      </form>
    </div>
  </div>
</div>
<div class="modal fade" id="noteModalEtc" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title fw-bold text-danger">고객 특이사항</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body bg-light p-4">
        <div class="bg-white p-4 rounded border shadow-sm fs-6" style="white-space: pre-wrap; min-height: 300px;">{{ people.chEtc or '내용 없음' }}</div>
      </div>
      <div class="modal-footer border-top-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="noteModalHistory" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title fw-bold text-warning">침해 대응 이력</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body bg-light p-4">
        <div class="bg-white p-4 rounded border shadow-sm fs-6" style="white-space: pre-wrap; min-height: 300px;">{{ people.chHistory or '내용 없음' }}</div>
      </div>
      <div class="modal-footer border-top-0">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}